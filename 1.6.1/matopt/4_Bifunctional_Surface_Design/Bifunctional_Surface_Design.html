

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bifunctional Catalyst Design &mdash; IDAES v1.6.1 Examples</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
<!-- Add Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Arimo|Roboto&display=swap"
      rel="stylesheet">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> IDAES Examples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../workshops/index.html">IDAES Workshop Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">IDAES Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../surrogate_models/index.html">Surrogate Modeling Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">MatOpt Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IDAES Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bifunctional Catalyst Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/matopt/4_Bifunctional_Surface_Design/Bifunctional_Surface_Design.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bifunctional-catalyst-design">
<h1>Bifunctional Catalyst Design<a class="headerlink" href="#bifunctional-catalyst-design" title="Permalink to this headline">¶</a></h1>
<p>This notebook serves as an example application of the MatOpt framework.
We consider an example optimization problem of designing a
nanostructured bifunctional catalyst. This example is a simplified
representation of the system presented in [1].</p>
<p>[1] Nunez, M., &amp; Vlachos, D. G. (2019). Ind. Eng. Chem. Res., 58,
6146-6154.</p>
<div class="section" id="importing-packages">
<h2>Importing Packages<a class="headerlink" href="#importing-packages" title="Permalink to this headline">¶</a></h2>
<p>We start by importing several standard Python modules for convienience.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>Finally, we import the MatOpt package in its entirety.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">idaes.apps.matopt</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="representing-materials">
<h2>Representing Materials<a class="headerlink" href="#representing-materials" title="Permalink to this headline">¶</a></h2>
<p>To begin, we define a <strong>Lattice</strong> object. In this example,
<strong>FCCLattice</strong> is a child class of Lattice. This object will serve to
define neighbor connections and helps us generically create other
objects.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IAD</span> <span class="o">=</span> <span class="mf">2.828</span> <span class="c1"># Angstrom</span>
<span class="n">Lat</span> <span class="o">=</span> <span class="n">FCCLattice</span><span class="o">.</span><span class="n">alignedWith111</span><span class="p">(</span><span class="n">IAD</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we define a <strong>Shape</strong> object that we will use to specify a design
space. Additionally, in this example our design space is periodic, so we
will define a <strong>Tiling</strong> object to hold information about the
periodicity. In this example, <strong>Parallelepiped</strong> and <strong>PlanarTiling</strong>
are the appropriate child classes for these objects, respectively.</p>
<p>Note that we shift the shape of our design space slightly, in order to
avoid confusion about which lattice sites that lie perfectly on the
shape facet should be included.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nUnitCellsOnEdge</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">nLayers</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">nUnitCellsOnEdge</span><span class="o">*</span><span class="n">IAD</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">nLayers</span><span class="o">*</span><span class="n">Lat</span><span class="o">.</span><span class="n">FCC111LayerSpacing</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Parallelepiped</span><span class="o">.</span><span class="n">fromEdgesAndAngles</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">c</span><span class="p">]))</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">PlanarTiling</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<p>Given the parameters for a design space, we can construct a <strong>Canvas</strong>
object to hold information about points and nearest neighbors. In this
example, the object is efficiently constructed from a scan over lattice
sites. In general, the Canvas can be constructed and manipulated via
user-defined algorithms.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Canv</span> <span class="o">=</span> <span class="n">Canvas</span><span class="o">.</span><span class="n">fromLatticeAndTilingScan</span><span class="p">(</span><span class="n">Lat</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<p>The Canvas object hold information about the design space and the
lattice sites, but it does not specify any material building block
information. To represent material configurations, use a <strong>Design</strong>
object.</p>
<p>Initially, the Design is empty. There are several ways to place <strong>Atom</strong>
(i.e., building block) objects in a Design. In this example, we are
initialize the Design to hold all Pt atoms.</p>
<p>To debug our work so far, we can create material structure files to load
and plot with standard visualization tools such as AtomEye. Here, we
create PDB (protein data bank format, www.rcsb.org) and CFG (AtomEye
configuration, li.mit.edu/A/Graphics/A/) files for the undoped design.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">Design</span><span class="p">(</span><span class="n">Canv</span><span class="p">,</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Pt&#39;</span><span class="p">))</span>
<span class="n">D</span><span class="o">.</span><span class="n">toPDB</span><span class="p">(</span><span class="s1">&#39;canvas.pdb&#39;</span><span class="p">)</span>
<span class="n">D</span><span class="o">.</span><span class="n">toCFG</span><span class="p">(</span><span class="s1">&#39;canvas.cfg&#39;</span><span class="p">,</span><span class="n">BBox</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="representing-conformations">
<h2>Representing Conformations<a class="headerlink" href="#representing-conformations" title="Permalink to this headline">¶</a></h2>
<p>In this material system, we would like to model the presence of facet
and edge sites on a patchy bimetallic catalyst surface. To do this
generically, we will create a list of conformations. This list will
later be used by MatOpt modeling methods to create common descriptor
formulations.</p>
<p>To begin, we create another Canvas object with one shell of neighbors
around a lattice location. Then, we create a list of Designs and set
their contents to match our intended conformations. To debug our work,
we also output conformations to file for plotting.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MotifCanvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">()</span>
<span class="n">MotifCanvas</span><span class="o">.</span><span class="n">addLocation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span><span class="n">NNeighbors</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">MotifCanvas</span><span class="o">.</span><span class="n">addShell</span><span class="p">(</span><span class="n">Lat</span><span class="o">.</span><span class="n">getNeighbors</span><span class="p">)</span>
<span class="n">Confs</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">MotifCanvas</span><span class="o">.</span><span class="n">NeighborhoodIndexes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="n">iToSetNi</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span>
<span class="n">iToSetPt</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">iConf</span><span class="p">,</span><span class="n">Conf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Confs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iToSetNi</span><span class="p">[</span><span class="n">iConf</span><span class="p">]:</span>
        <span class="n">Conf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Ni&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iToSetPt</span><span class="p">[</span><span class="n">iConf</span><span class="p">]:</span>
        <span class="n">Conf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Pt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="building-the-model">
<h2>Building the Model<a class="headerlink" href="#building-the-model" title="Permalink to this headline">¶</a></h2>
<p>To begin, we define several sets and constants that will be used in
creating the model.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TypeAConfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">TypeBConfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">LocsToFixPt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Canv</span><span class="p">))</span> <span class="k">if</span> <span class="n">Canv</span><span class="o">.</span><span class="n">Points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Lat</span><span class="o">.</span><span class="n">FCC111LayerSpacing</span><span class="o">*</span><span class="mf">2.5</span><span class="p">]</span>
<span class="n">LocsToExcludePt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Canv</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LocsToFixPt</span><span class="p">]</span>
<span class="n">CanvTwoBotLayers</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Canv</span><span class="p">))</span> <span class="k">if</span> <span class="n">Canv</span><span class="o">.</span><span class="n">Points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Lat</span><span class="o">.</span><span class="n">FCC111LayerSpacing</span><span class="o">*</span><span class="mf">1.5</span><span class="p">]</span>
<span class="n">CanvMinusTwoBotLayers</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Canv</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CanvTwoBotLayers</span><span class="p">]</span>
<span class="n">OneLocToFix</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">LocsToExcludePt</span><span class="p">)]</span>
<span class="n">TileSizeSquared</span> <span class="o">=</span> <span class="n">nUnitCellsOnEdge</span><span class="o">**</span><span class="mi">2</span>
<span class="n">CatNorm</span> <span class="o">=</span> <span class="n">TileSizeSquared</span><span class="o">*</span><span class="mf">6.0</span>
<span class="n">UndefectedSurfE</span> <span class="o">=</span> <span class="mf">0.129758</span>
<span class="n">maxSurfE</span> <span class="o">=</span> <span class="mi">999</span>
<span class="n">CatWeight</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Ni&#39;</span><span class="p">),</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Pt&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Next, we create a <strong>*MatOptModel*</strong> object.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MatOptModel</span><span class="p">(</span><span class="n">Canv</span><span class="p">,</span><span class="n">Atoms</span><span class="p">,</span><span class="n">Confs</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, several basic variables are pre-defined. See the first
example, <strong>*Monometallic_Nanocluster_Design.ipynb*</strong> for a description
of basic variables, expressions, and constraint rules.</p>
<p>First, we fix the composition of atoms in the appropriate layers.
Effectively, we are designing the defects in a single layer of Ni on top
of an undefected Pt surface.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">Yik</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FixedTo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">sites</span><span class="o">=</span><span class="n">LocsToFixPt</span><span class="p">,</span><span class="n">site_types</span><span class="o">=</span><span class="p">[</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Pt&#39;</span><span class="p">)]))</span>
<span class="n">m</span><span class="o">.</span><span class="n">Yik</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FixedTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sites</span><span class="o">=</span><span class="n">LocsToExcludePt</span><span class="p">,</span><span class="n">site_types</span><span class="o">=</span><span class="p">[</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Pt&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Next, we define indicators for the presence of groups of conformations
(corresponding to facet and edge sites) in the design. We arbitrarily
fix one site to be a facet-type site, breaking symmetry and improving
the tractability of the resulting optimization models.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">Zic</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FixedTo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">sites</span><span class="o">=</span><span class="n">OneLocToFix</span><span class="p">,</span><span class="n">confs</span><span class="o">=</span><span class="n">TypeAConfs</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">Zic</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Implies</span><span class="p">(</span><span class="n">concs</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Yik</span><span class="p">,</span><span class="n">EqualTo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">site_types</span><span class="o">=</span><span class="p">[</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Ni&#39;</span><span class="p">)]))))</span>
<span class="n">SumAConfsExpr</span> <span class="o">=</span> <span class="n">SumConfs</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Zic</span><span class="p">,</span><span class="n">confs_to_sum</span><span class="o">=</span><span class="n">TypeAConfs</span><span class="p">)</span>
<span class="n">SumBConfsExpr</span> <span class="o">=</span> <span class="n">SumConfs</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Zic</span><span class="p">,</span><span class="n">confs_to_sum</span><span class="o">=</span><span class="n">TypeBConfs</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">addBondsDescriptor</span><span class="p">(</span><span class="s1">&#39;SiteCombinations&#39;</span><span class="p">,</span><span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">rules</span><span class="o">=</span><span class="n">ImpliesSiteCombination</span><span class="p">(</span><span class="n">Canv</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="n">SumAConfsExpr</span><span class="p">,</span><span class="n">GreaterThan</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="n">SumBConfsExpr</span><span class="p">,</span><span class="n">GreaterThan</span><span class="p">(</span><span class="mi">1</span><span class="p">))))</span>
</pre></div>
</div>
<p>Next, we define activity as a normalized sum of contributions from site
combinations. Additionally, we introduce a model for the surface energy
of sites as a piecewise linear function of coordination number.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">addGlobalDescriptor</span><span class="p">(</span><span class="s1">&#39;Activity&#39;</span><span class="p">,</span>
                      <span class="n">rules</span><span class="o">=</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">SumBonds</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SiteCombinations</span><span class="p">,</span><span class="n">coefs</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">CatNorm</span><span class="p">)))</span>

<span class="n">EiVals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04293</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mf">0.41492</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04293</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mf">0.41492</span><span class="p">,</span> <span class="mf">0.05179</span><span class="o">*</span><span class="mi">11</span><span class="o">-</span><span class="mf">0.62148</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">EiBPs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">m</span><span class="o">.</span><span class="n">addSitesDescriptor</span><span class="p">(</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span>
                     <span class="n">rules</span><span class="o">=</span><span class="n">PiecewiseLinear</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">EiVals</span><span class="p">,</span>
                                           <span class="n">breakpoints</span><span class="o">=</span><span class="n">EiBPs</span><span class="p">,</span>
                                          <span class="n">input_desc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">Ci</span><span class="p">),</span>
                     <span class="n">sites</span><span class="o">=</span><span class="n">CanvMinusTwoBotLayers</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">addGlobalDescriptor</span><span class="p">(</span><span class="s1">&#39;Esurf&#39;</span><span class="p">,</span>
                      <span class="n">rules</span><span class="o">=</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">SumSites</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Ei</span><span class="p">,</span><span class="n">coefs</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">TileSizeSquared</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mf">0.101208</span><span class="p">)))</span>
<span class="n">m</span><span class="o">.</span><span class="n">addGlobalDescriptor</span><span class="p">(</span><span class="s1">&#39;Stability&#39;</span><span class="p">,</span>
                      <span class="n">rules</span><span class="o">=</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">LinearExpr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Esurf</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">UndefectedSurfE</span><span class="p">)))</span>
</pre></div>
</div>
<p>Finally, we introduce a single descriptor for the weighted combination
of acitivity and stability. By changing the parameter weighting the
catalytic portion of the objective function, we can optimize for a range
of designs optimizing stability and activity.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">addGlobalDescriptor</span><span class="p">(</span><span class="s1">&#39;ActAndStab&#39;</span><span class="p">,</span>
                      <span class="n">rules</span><span class="o">=</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">LinearExpr</span><span class="p">(</span><span class="n">descs</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">Stability</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">Activity</span><span class="p">],</span>
                                               <span class="n">coefs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">CatWeight</span><span class="p">),</span><span class="n">CatWeight</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="section" id="solving-the-model">
<h2>Solving the Model<a class="headerlink" href="#solving-the-model" title="Permalink to this headline">¶</a></h2>
<p>Given a fully formed Pyomo model, we have several capabilities to
optimize and visualize the solution. In this example, we simply call the
maximize method to optimize the balance of activity and stability</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">maximize</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ActAndStab</span><span class="p">,</span><span class="n">tilim</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MaOpt can not find usable solver (CPLEX or NEOS-CPLEX)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WARNING: DEPRECATED: SetProduct.set_tuple is deprecated.  Use
    SetProduct.subsets() to get the operator arguments.  (deprecated in TBD)
    (called from /home/ksb/anaconda3/envs/idaes-pse/lib/python3.7/site-
    packages/idaes/apps/matopt/../matopt/opt/pyomo_modeling.py:284)

Welcome to IBM(R) ILOG(R) CPLEX(R) Interactive Optimizer Community Edition 12.9.0.0
  with Simplex, Mixed Integer &amp; Barrier Optimizers
5725-A06 5725-A29 5724-Y48 5724-Y49 5724-Y54 5724-Y55 5655-Y21
Copyright IBM Corp. 1988, 2019.  All Rights Reserved.

Type &#39;help&#39; for a list of available commands.
Type &#39;help&#39; followed by a command name for more
information on commands.

CPLEX&gt; Logfile &#39;cplex.log&#39; closed.
Logfile &#39;/tmp/tmpmp38nwpe.cplex.log&#39; open.
CPLEX&gt; New value for absolute mixed integer optimality gap tolerance: 0
CPLEX&gt; New value for mixed integer optimality gap tolerance: 0
CPLEX&gt; New value for time limit in seconds: 360
CPLEX&gt; Problem &#39;/tmp/tmpn99ocl40.pyomo.lp&#39; read.
Read time = 0.06 sec. (3.48 ticks)
CPLEX&gt; Problem name         : /tmp/tmpn99ocl40.pyomo.lp
Objective sense      : Maximize
Variables            :    8194  [Nneg: 1,  Free: 644,  Binary: 7165,
                                 General Integer: 384]
Objective nonzeros   :       1
Linear constraints   :   36613  [Less: 35200,  Greater: 128,  Equal: 1285]
  Nonzeros           :   92491
  RHS nonzeros       :   12680

Variables            : Min LB: 0.000000         Max UB: 12.00000
Objective nonzeros   : Min   : 1.000000         Max   : 1.000000
Linear constraints   :
  Nonzeros           : Min   : 0.002604167      Max   : 12.00000
  RHS nonzeros       : Min   : 0.1012080        Max   : 9.000000
CPLEX&gt; CPLEX Error  1016: Community Edition. Problem size limits exceeded. Purchase at https://ibm.co/2s0wqSa.

Error termination, CPLEX Error  1016.
Solution time =    0.00 sec.
Deterministic time = 0.00 ticks  (0.00 ticks/sec)

CPLEX&gt; CPLEX Error  1217: No solution exists.
No file written.
CPLEX&gt; ERROR: evaluating object as numeric value: obj
        (object: &lt;class &#39;pyomo.core.base.objective.SimpleObjective&#39;&gt;)
    No value for uninitialized NumericValue object obj
MaOpt can not find usable solver (CPLEX or NEOS-CPLEX)
</pre></div>
</div>
</div>
<div class="section" id="processing-solutions">
<h2>Processing Solutions<a class="headerlink" href="#processing-solutions" title="Permalink to this headline">¶</a></h2>
<p>Once the model is solved, we can interpret the solutions as labelings of
a Design object. To accompolish this, we use the
<strong>*setDesignFromModel*</strong> function. Then, we can write the Design object
to PDB or CFG files for plotting.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">D</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">D</span><span class="o">.</span><span class="n">toCFG</span><span class="p">(</span><span class="s1">&#39;result.cfg&#39;</span><span class="p">,</span><span class="n">BBox</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
        <span class="n">PeriodicD</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">replicateDesign</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">PeriodicS</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        <span class="n">PeriodicS</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">PeriodicD</span><span class="o">.</span><span class="n">toCFG</span><span class="p">(</span><span class="s1">&#39;periodic_result.cfg&#39;</span><span class="p">,</span><span class="n">BBox</span><span class="o">=</span><span class="n">PeriodicS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        
        &copy; <a href="../../copyright.html">Copyright</a> DOE Institute for the Design of Advanced Energy Systems (IDAES), 2018-2020

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div id="bottombanner">
    The IDAES team:
    <ul>
        <li>National Energy Technology Laboratory (Lead)</li>
        <li>Sandia National Laboratory</li>
        <li>Lawrence Berkeley National Laboratory</li>
        <li>Carnegie-Mellon University (subcontract to LBNL)</li>
        <li>West Virginia University (subcontract to LBNL)</li>
    </ul>
    <div id="contactinfo">
        General, background and overview information<br/> is available at the
        <a href="https://www.idaes.org>">IDAES main website</a>
    </div>
</div>


</body>
</html>