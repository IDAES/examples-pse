<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heat Exchanger 1D Unit Model with Two Property Packages &mdash; IDAES v2.0.0 Examples</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Heat Exchanger Lumped-Capacitance Unit Model with Two Property Packages" href="heat_exchanger_lc.html" />
    <link rel="prev" title="Heat Exchanger 0D Unit Model with Two Property Packages" href="heat_exchanger_0D.html" />
<!-- Add Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Arimo|Roboto&display=swap"
      rel="stylesheet">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            IDAES Examples
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Advanced/index.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Flowsheets/index.html">Flowsheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../MatOpt/index.html">MatOpt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../SurrMod/index.html">Surrogate modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Tools/index.html">Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Unit models</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Operations</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="compressor_doc.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="feed_doc.html">Feed</a></li>
<li class="toctree-l4"><a class="reference internal" href="feed_flash_doc.html">Feed Flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="flash_doc.html">Flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="heater_doc.html">Heater</a></li>
<li class="toctree-l4"><a class="reference internal" href="heat_exchanger_0D.html">Heat Exchanger 0D</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Heat Exchanger 1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="heat_exchanger_lc.html">Heat Exchanger lc</a></li>
<li class="toctree-l4"><a class="reference internal" href="heat_exchanger_NTU.html">Heat Exchanger NTU</a></li>
<li class="toctree-l4"><a class="reference internal" href="mixer_doc.html">Mixer</a></li>
<li class="toctree-l4"><a class="reference internal" href="product_doc.html">Product</a></li>
<li class="toctree-l4"><a class="reference internal" href="pump_doc.html">Pump</a></li>
<li class="toctree-l4"><a class="reference internal" href="separator_doc.html">Separator</a></li>
<li class="toctree-l4"><a class="reference internal" href="statejunction_doc.html">Statejunction</a></li>
<li class="toctree-l4"><a class="reference internal" href="translator_doc.html">Translator</a></li>
<li class="toctree-l4"><a class="reference internal" href="turbine_doc.html">Turbine</a></li>
<li class="toctree-l4"><a class="reference internal" href="valve_doc.html">Valve</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Reactors/index.html">Unit models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Pecos/index.html">Pecos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/index.html">IDAES Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDAES Examples</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Unit models</a></li>
          <li class="breadcrumb-item"><a href="index.html">Operations</a></li>
      <li class="breadcrumb-item active">Heat Exchanger 1D Unit Model with Two Property Packages</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Examples/UnitModels/Operations/heat_exchanger_1D.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="heat-exchanger-1d-unit-model-with-two-property-packages">
<h1>Heat Exchanger 1D Unit Model with Two Property Packages<a class="headerlink" href="#heat-exchanger-1d-unit-model-with-two-property-packages" title="Permalink to this heading">¶</a></h1>
<img alt="../../../_images/heat_exchanger_4.svg" src="../../../_images/heat_exchanger_4.svg" /><p><strong>Problem Statement</strong>: In this example, we will be heating a
benzene-toluene mixture using steam.</p>
<p><strong>Tube Side Inlet</strong></p>
<p>Flow Rate = 250 mol/s</p>
<p>Mole fraction (Benzene) = 0.4</p>
<p>Mole fraction (Toluene) = 0.6</p>
<p>Pressure = 101325 Pa</p>
<p>Temperature = 350 K</p>
<p><strong>Shell Side Inlet</strong></p>
<p>Flow Rate = 100 mol/s</p>
<p>Mole fraction (Steam) = 1</p>
<p>Pressure = 101325 Pa</p>
<p>Temperature = 450 K</p>
<p>This example will demonstrate the simulation of the 1D heat exchanger by
fixing any 7 of the following degrees of freedom: - two of shell length,
diameter, and area - two of tube length, diameter, and area - number of
tubes - wall temperature (at all spatial points) - heat transfer
coefficient (at all spatial points, for both shell and tube)</p>
<p>IDAES documentation reference for heat exchanger 1D model:
<a class="reference external" href="https://idaes-pse.readthedocs.io/en/latest/reference_guides/model_libraries/generic/unit_models/heat_exchanger_1D.html">https://idaes-pse.readthedocs.io/en/latest/reference_guides/model_libraries/generic/unit_models/heat_exchanger_1D.html</a></p>
<p>This example utilizes the simple 1D heat exchanger for a shell and tube
system. The IDAES library contains a more advanced <code class="docutils literal notranslate"><span class="pre">ShellAndTube1D</span></code>
heat exchanger supporting a 0D wall conduction model; more details on
the advanced 1D heat exchanger may be found
<a class="reference external" href="https://idaes-pse.readthedocs.io/en/latest/reference_guides/model_libraries/generic/unit_models/shell_and_tube_1d.html">here</a>.</p>
<section id="importing-necessary-tools">
<h2>Importing necessary tools<a class="headerlink" href="#importing-necessary-tools" title="Permalink to this heading">¶</a></h2>
<p>First, import the required IDAES and Pyomo modules. Note that the
hotside (shell) and coldside (tube) properties leverage separate
property packages:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import pyomo package</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">ConcreteModel</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">units</span>

<span class="c1"># Import idaes logger to set output levels</span>
<span class="kn">import</span> <span class="nn">idaes.logger</span> <span class="k">as</span> <span class="nn">idaeslog</span>

<span class="c1"># Import the main FlowsheetBlock from IDAES. The flowsheet block will contain the unit model</span>
<span class="kn">from</span> <span class="nn">idaes.core</span> <span class="kn">import</span> <span class="n">FlowsheetBlock</span>

<span class="c1"># Import the IAPWS property package to create a properties block for steam in the flowsheet</span>
<span class="kn">from</span> <span class="nn">idaes.models.properties</span> <span class="kn">import</span> <span class="n">iapws95</span>

<span class="kn">from</span> <span class="nn">idaes.models.properties.iapws95</span> <span class="kn">import</span> <span class="n">htpx</span>

<span class="kn">from</span> <span class="nn">idaes.models.properties.modular_properties.base.generic_property</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">GenericParameterBlock</span><span class="p">)</span>

<span class="c1"># Import the BT_ideal property package to create a properties block for the tube side in the flowsheet</span>
<span class="kn">from</span> <span class="nn">idaes.models.properties.modular_properties.examples.BT_ideal</span> \
    <span class="kn">import</span> <span class="nn">configuration</span>

<span class="c1"># Import the degrees_of_freedom function from the idaes.core.util.model_statistics package</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.model_statistics</span> <span class="kn">import</span> <span class="n">degrees_of_freedom</span>

<span class="c1"># Import the default IPOPT solver</span>
<span class="kn">from</span> <span class="nn">idaes.core.solvers</span> <span class="kn">import</span> <span class="n">get_solver</span>

<span class="c1"># Import a heat exchanger unit</span>
<span class="kn">from</span> <span class="nn">idaes.models.unit_models.heat_exchanger_1D</span> <span class="kn">import</span> <span class="p">(</span><span class="n">HeatExchanger1D</span><span class="p">,</span>
                                                        <span class="n">HeatExchangerFlowPattern</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setting-up-the-flowsheet">
<h2>Setting up the flowsheet<a class="headerlink" href="#setting-up-the-flowsheet" title="Permalink to this heading">¶</a></h2>
<p>Then, create the <code class="docutils literal notranslate"><span class="pre">ConcreteModel</span></code> foundation, attach the steady state
flowsheet, and declare the property parameter block that will used for
the shell and tube sides.</p>
<p>More information on this general workflow can be found here:
<a class="reference external" href="https://idaes-pse.readthedocs.io/en/stable/how_to_guides/workflow/general.html">https://idaes-pse.readthedocs.io/en/stable/how_to_guides/workflow/general.html</a></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">FlowsheetBlock</span><span class="p">(</span><span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">properties_shell</span> <span class="o">=</span> <span class="n">iapws95</span><span class="o">.</span><span class="n">Iapws95ParameterBlock</span><span class="p">()</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">properties_tube</span> <span class="o">=</span> <span class="n">GenericParameterBlock</span><span class="p">(</span><span class="o">**</span><span class="n">configuration</span><span class="p">)</span>
</pre></div>
</div>
<p>In the <a class="reference external" href="http://localhost:8888/notebooks/GitHub/examples-pse/src/Examples/UnitModels/Operations/heat_exchanger_0D_testing.ipynb">0D Heat Exchanger model
example</a>,
geometry effects are ignored in favor of temperature gradients to
calculate heat transfer. Here, we need to specify discretization, a flow
configuration and wall conduction assumption. We specify the
one-dimensional spatial discretization to use backwards finite
difference approximations with 20 finite elements - these are the
defaults if none are specified explicitly, and the shell and tube
domains may be discretized differently if desired. The domains must use
the same number of finite elements, as the exchanger is linear and the
elements directly correspond according to the selected flow pattern.</p>
<p>The 1D Heat Exchanger supports the following flow configuration options:</p>
<ul class="simple">
<li><p>HeatExchangerFlowPattern.cocurrent. Shell and tube flow in parallel,
tube inlet transfers with shell inlet and similar with outlets, and
temperature difference is greatest at the flow inlets (default).</p></li>
<li><p>HeatExchangerFlowPattern.countercurrent. Shell and tube flow in
anti-parallel, tube inlet transfers with shell outlet and vice versa,
and temperature difference changes minimally along the exchanger
length.</p></li>
</ul>
<p>The unit is created below:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of the heat exchanger unit, attaching it to the flowsheet</span>
<span class="c1"># Specify that the property packages to be used with the heat exchanger are the ones we created earlier.</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span> <span class="o">=</span> <span class="n">HeatExchanger1D</span><span class="p">(</span>
    <span class="n">hot_side_name</span><span class="o">=</span><span class="s2">&quot;shell&quot;</span><span class="p">,</span>
    <span class="n">cold_side_name</span><span class="o">=</span><span class="s2">&quot;tube&quot;</span><span class="p">,</span>
    <span class="n">shell</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;property_package&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">properties_shell</span><span class="p">,</span>
           <span class="s2">&quot;transformation_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dae.finite_difference&quot;</span><span class="p">,</span>
           <span class="s2">&quot;transformation_scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;BACKWARD&quot;</span><span class="p">},</span>
    <span class="n">tube</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;property_package&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">properties_tube</span><span class="p">,</span>
          <span class="s2">&quot;transformation_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dae.finite_difference&quot;</span><span class="p">,</span>
          <span class="s2">&quot;transformation_scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;BACKWARD&quot;</span><span class="p">},</span>
    <span class="n">finite_elements</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">flow_type</span><span class="o">=</span><span class="n">HeatExchangerFlowPattern</span><span class="o">.</span><span class="n">cocurrent</span><span class="p">)</span>

<span class="c1"># Call the degrees_of_freedom function, get initial DOF</span>
<span class="n">DOF_initial</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The initial DOF is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOF_initial</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">initial</span> <span class="n">DOF</span> <span class="ow">is</span> <span class="mi">31</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">DOF_initial</span> <span class="o">==</span> <span class="mi">31</span>
</pre></div>
</div>
</section>
<section id="fixing-input-specifications">
<h2>Fixing input specifications<a class="headerlink" href="#fixing-input-specifications" title="Permalink to this heading">¶</a></h2>
<p>For this problem, we will fix the inlet conditions, re-evaluate the
degrees of freedom to ensure the problem is square (i.e. DOF=0), and run
two different options for unit specifications:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">htpx</span><span class="p">(</span><span class="mi">450</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">101325</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Pa</span><span class="p">)</span>  <span class="c1"># calculate IAPWS enthalpy</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">hot_side_inlet</span><span class="o">.</span><span class="n">flow_mol</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># mol/s</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">hot_side_inlet</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">101325</span><span class="p">)</span> <span class="c1"># Pa</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">hot_side_inlet</span><span class="o">.</span><span class="n">enth_mol</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="c1"># J/mol</span>

<span class="n">DOF_initial</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DOF is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOF_initial</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">DOF</span> <span class="ow">is</span> <span class="mi">28</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_inlet</span><span class="o">.</span><span class="n">flow_mol</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="c1"># mol/s</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_inlet</span><span class="o">.</span><span class="n">mole_frac_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;benzene&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_inlet</span><span class="o">.</span><span class="n">mole_frac_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;toluene&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_inlet</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">101325</span><span class="p">)</span> <span class="c1"># Pa</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_inlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">350</span><span class="p">)</span> <span class="c1"># K</span>

<span class="n">DOF_final</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DOF is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOF_final</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">DOF</span> <span class="ow">is</span> <span class="mi">23</span>
</pre></div>
</div>
<section id="option-1-fix-heat-transfer-coefficient-htc-and-dimensions-of-each-domain">
<h3>Option 1: Fix heat transfer coefficient (HTC) and dimensions of each domain<a class="headerlink" href="#option-1-fix-heat-transfer-coefficient-htc-and-dimensions-of-each-domain" title="Permalink to this heading">¶</a></h3>
<p>Below, we fix the heat exchanger area, length and heat transfer
coefficient, which yields a fully defined problem for all finite
elements with zero degrees of freedom that may be initialized and
solved:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># m2</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">4.85</span><span class="p">)</span> <span class="c1"># m</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">heat_transfer_coefficient</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="c1"># W/m2/K</span>

<span class="n">DOF_final</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DOF is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOF_final</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">DOF</span> <span class="ow">is</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">DOF_final</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Now that the problem is square (zero degress of freedom), we can
initialize and solve the full model:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the flowsheet, and set the output at INFO</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">outlvl</span><span class="o">=</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Solve the simulation using ipopt</span>
<span class="c1"># Note: If the degrees of freedom = 0, we have a square problem</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">get_solver</span><span class="p">()</span>
<span class="n">solve_status</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tee</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display a readable report</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.hot_side: Initialization Complete
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: Starting initialization
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: Dew and bubble point initialization: optimal - Optimal Solution Found.
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: Equilibrium temperature initialization completed.
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: State variable initialization completed.
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: Phase equilibrium initialization: optimal - Optimal Solution Found.
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side.properties: Property initialization: optimal - Optimal Solution Found.
2023-03-04 00:53:09 [INFO] idaes.init.fs.heat_exchanger.cold_side: Initialization Complete
2023-03-04 00:53:10 [INFO] idaes.init.fs.heat_exchanger: Initialization Complete.
Ipopt 3.13.2: nlp_scaling_method=gradient-based
tol=1e-06
max_iter=200


<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     2903
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:     1121

Total number of variables............................:      907
                     variables with only lower bounds:      126
                variables with lower and upper bounds:      308
                     variables with only upper bounds:        0
Total number of equality constraints.................:      907
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 7.51e+02 1.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 7.50e+00 8.47e-01  -1.0 4.26e-01    -  9.90e-01 9.90e-01h  1
   2  0.0000000e+00 6.00e-02 2.00e+00  -1.0 3.47e-03    -  9.90e-01 9.92e-01h  1
   3  0.0000000e+00 3.03e-08 9.98e+02  -1.0 2.77e-05    -  9.90e-01 1.00e+00h  1

Number of Iterations....: 3

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   3.0293449526652694e-08    3.0293449526652694e-08
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   3.0293449526652694e-08    3.0293449526652694e-08


Number of objective function evaluations             = 4
Number of objective gradient evaluations             = 4
Number of equality constraint evaluations            = 4
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 4
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 3
Total CPU secs in IPOPT (w/o function evaluations)   =      0.049
Total CPU secs in NLP function evaluations           =      0.094

EXIT: Optimal Solution Found.

====================================================================================
Unit : fs.heat_exchanger                                                   Time: 0.0
------------------------------------------------------------------------------------
    Unit Performance

    Variables:

    Key    : Value   : Units      : Fixed : Bounds
      Area : 0.50000 : meter ** 2 :  True : (None, None)
    Length :  4.8500 :      meter :  True : (None, None)

------------------------------------------------------------------------------------
    Stream Table
                                      Units        shell Inlet shell Outlet tube Inlet tube Outlet
    Molar Flow                       mole / second       100        100.00           -           -
    Mass Flow                    kilogram / second    1.8015        1.8015           -           -
    T                                       kelvin    450.00        444.47           -           -
    P                                       pascal    101325    1.0132e+05           -           -
    Vapor Fraction                   dimensionless    1.0000        1.0000           -           -
    Molar Enthalpy                    joule / mole    50977.        50780.           -           -
    Total Molar Flowrate             mole / second         -             -         250      250.00
    Total Mole Fraction benzene      dimensionless         -             -     0.40000     0.40000
    Total Mole Fraction toluene      dimensionless         -             -     0.60000     0.60000
    Temperature                             kelvin         -             -         350      368.39
    Pressure                                pascal         -             -  1.0132e+05  1.0132e+05
====================================================================================</pre>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">assert_optimal_termination</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># Check if termination condition is optimal</span>
<span class="n">assert_optimal_termination</span><span class="p">(</span><span class="n">solve_status</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">hot_side_outlet</span><span class="o">.</span><span class="n">enth_mol</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span>
    <span class="n">htpx</span><span class="p">(</span><span class="mf">444.47</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">101325</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Pa</span><span class="p">),</span> <span class="n">rel</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span>
    <span class="mf">368.39</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="option-2-unfix-shell-length-and-fix-shell-outlet-temperatures">
<h3>Option 2: Unfix shell length and fix shell outlet temperatures<a class="headerlink" href="#option-2-unfix-shell-length-and-fix-shell-outlet-temperatures" title="Permalink to this heading">¶</a></h3>
<p>In the previous case, we fixed the heat exchanger area, length and
overall heat transfer coefficient. However, given that the models in
IDAES are equation oriented, we can fix the outlet variables. For
example, we can fix the hot outlet temperature and heat exchanger
length, and solve for the heat exchanger area that will satisfy that
condition.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">hot_side_outlet</span><span class="o">.</span><span class="n">enth_mol</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">htpx</span><span class="p">(</span><span class="mf">444.47</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">101325</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Pa</span><span class="p">))</span>

<span class="n">DOF_final</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DOF is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOF_final</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">DOF</span> <span class="ow">is</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># Display a readable report</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">Problem:
- Lower bound: -inf
  Upper bound: inf
  Number of objectives: 1
  Number of constraints: 907
  Number of variables: 907
  Sense: unknown
Solver:
- Status: ok
  Message: Ipopt 3.13.2x3a Optimal Solution Found
  Termination condition: optimal
  Id: 0
  Error rc: 0
  Time: 0.15509271621704102
Solution:
- number of solutions: 0
  number of solutions displayed: 0


====================================================================================
Unit : fs.heat_exchanger                                                   Time: 0.0
------------------------------------------------------------------------------------
    Unit Performance

    Variables:

    Key    : Value   : Units      : Fixed : Bounds
      Area : 0.50043 : meter ** 2 : False : (None, None)
    Length :  4.8500 :      meter :  True : (None, None)

------------------------------------------------------------------------------------
    Stream Table
                                      Units        shell Inlet shell Outlet tube Inlet tube Outlet
    Molar Flow                       mole / second       100        100.00           -           -
    Mass Flow                    kilogram / second    1.8015        1.8015           -           -
    T                                       kelvin    450.00        444.47           -           -
    P                                       pascal    101325    1.0132e+05           -           -
    Vapor Fraction                   dimensionless    1.0000        1.0000           -           -
    Molar Enthalpy                    joule / mole    50977.        50780.           -           -
    Total Molar Flowrate             mole / second         -             -         250      250.00
    Total Mole Fraction benzene      dimensionless         -             -     0.40000     0.40000
    Total Mole Fraction toluene      dimensionless         -             -     0.60000     0.60000
    Temperature                             kelvin         -             -         350      368.39
    Pressure                                pascal         -             -  1.0132e+05  1.0132e+05
====================================================================================</pre>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if termination condition is optimal</span>
<span class="n">assert_optimal_termination</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">area</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heat_exchanger</span><span class="o">.</span><span class="n">cold_side_outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span>
    <span class="mf">368.39</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="heat_exchanger_0D.html" class="btn btn-neutral float-left" title="Heat Exchanger 0D Unit Model with Two Property Packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="heat_exchanger_lc.html" class="btn btn-neutral float-right" title="Heat Exchanger Lumped-Capacitance Unit Model with Two Property Packages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright DOE Institute for the Design of Advanced Energy Systems (IDAES), 2018-2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div id="bottombanner">
    The IDAES team:
    <ul>
        <li>National Energy Technology Laboratory (Lead)</li>
        <li>Sandia National Laboratory</li>
        <li>Lawrence Berkeley National Laboratory</li>
        <li>Carnegie-Mellon University (subcontract to LBNL)</li>
        <li>West Virginia University (subcontract to LBNL)</li>
    </ul>
    <div id="contactinfo">
        General, background and overview information<br/> is available at the
        <a href="https://www.idaes.org>">IDAES main website</a>
    </div>
</div>


</body>
</html>