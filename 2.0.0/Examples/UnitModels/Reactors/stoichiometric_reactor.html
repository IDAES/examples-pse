<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flowsheet Stoichiometric Reactor Simulation and Optimization of Ethylene Glycol Production &mdash; IDAES v2.0.0 Examples</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<!-- Add Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Arimo|Roboto&display=swap"
      rel="stylesheet">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            IDAES Examples
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/index.html">IDAES Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDAES Examples</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Flowsheet Stoichiometric Reactor Simulation and Optimization of Ethylene Glycol Production</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Examples/UnitModels/Reactors/stoichiometric_reactor.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="flowsheet-stoichiometric-reactor-simulation-and-optimization-of-ethylene-glycol-production">
<h1>Flowsheet Stoichiometric Reactor Simulation and Optimization of Ethylene Glycol Production<a class="headerlink" href="#flowsheet-stoichiometric-reactor-simulation-and-optimization-of-ethylene-glycol-production" title="Permalink to this heading">¶</a></h1>
<section id="learning-outcomes">
<h2>Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Call and implement the IDAES StochiometricReactor unit model</p></li>
<li><p>Construct a steady-state flowsheet using the IDAES unit model library</p></li>
<li><p>Connecting unit models in a flowsheet using Arcs</p></li>
<li><p>Fomulate and solve an optimization problem</p>
<ul>
<li><p>Defining an objective function</p></li>
<li><p>Setting variable bounds</p></li>
<li><p>Adding additional constraints</p></li>
</ul>
</li>
</ul>
</section>
<section id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this heading">¶</a></h2>
<p>Following the previous example implementing a <a class="reference external" href="http://localhost:8888/notebooks/GitHub/examples-pse/src/Examples/UnitModels/Reactors/cstr_testing.ipynb">Continuous Stirred Tank
Reactor (CSTR) unit
model</a>,
we can alter the flowsheet to use a stochiometric (or yield) reactor. As
before, this example is adapted from Fogler, H.S., Elements of Chemical
Reaction Engineering 5th ed., 2016, Prentice Hall, p. 157-160 with the
following chemical reaction, property packages and flowsheet. Unlike the
previous two reactors which apply performance equations to calculate
reaction extent, this simplified reactor model neglects all geometric
properties and allows the user to specify a yield per reaction. The
state variables chosen for the property package are <strong>molar flows of
each component by phase in each stream, temperature of each stream and
pressure of each stream</strong>. The components considered are: <strong>ethylene
oxide, water, sulfuric acid and ethylene glycol</strong> and the process occurs
in liquid phase only. Therefore, every stream has 4 flow variables, 1
temperature and 1 pressure variable.</p>
<p>Chemical reaction:</p>
<p><strong>C2H4O + H2O + H2SO4 → C2H6O2 + H2SO4</strong></p>
<p>Property Packages:</p>
<ul class="simple">
<li><p>egprod_ideal.py</p></li>
<li><p>egprod_reaction.py</p></li>
</ul>
<p>Flowsheet:</p>
<img alt="../../../_images/egprod_flowsheet.png" src="../../../_images/egprod_flowsheet.png" />
</section>
<section id="importing-required-pyomo-and-idaes-components">
<h2>Importing Required Pyomo and IDAES components<a class="headerlink" href="#importing-required-pyomo-and-idaes-components" title="Permalink to this heading">¶</a></h2>
<p>To construct a flowsheet, we will need several components from the Pyomo
and IDAES packages. Let us first import the following components from
Pyomo: - Constraint (to write constraints) - Var (to declare variables)
- ConcreteModel (to create the concrete model object) - Expression (to
evaluate values as a function of variables defined in the model) -
Objective (to define an objective function for optimization) -
TransformationFactory (to apply certain transformations) - Arc (to
connect two unit models)</p>
<p>For further details on these components, please refer to the pyomo
documentation: <a class="reference external" href="https://pyomo.readthedocs.io/en/latest/">https://pyomo.readthedocs.io/en/latest/</a></p>
<p>From idaes, we will be needing the <code class="docutils literal notranslate"><span class="pre">FlowsheetBlock</span></code> and the following
unit models: - Mixer - Heater - StoichiometricReactor</p>
<p>We will also be needing some utility tools to put together the flowsheet
and calculate the degrees of freedom, tools for model expressions and
calling variable values, and built-in functions to define property
packages, add unit containers to objects and define our initialization
scheme.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Constraint</span><span class="p">,</span>
                           <span class="n">Var</span><span class="p">,</span>
                           <span class="n">ConcreteModel</span><span class="p">,</span>
                           <span class="n">Expression</span><span class="p">,</span>
                           <span class="n">Objective</span><span class="p">,</span>
                           <span class="n">TransformationFactory</span><span class="p">,</span>
                           <span class="n">value</span><span class="p">,</span>
                           <span class="n">units</span> <span class="k">as</span> <span class="n">pyunits</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyomo.network</span> <span class="kn">import</span> <span class="n">Arc</span>

<span class="kn">from</span> <span class="nn">idaes.core</span> <span class="kn">import</span> <span class="n">FlowsheetBlock</span>
<span class="kn">from</span> <span class="nn">idaes.models.properties.modular_properties.base.generic_property</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">GenericParameterBlock</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">idaes.models.properties.modular_properties.base.generic_reaction</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">GenericReactionParameterBlock</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">idaes.models.unit_models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Feed</span><span class="p">,</span>
                                      <span class="n">Mixer</span><span class="p">,</span>
                                      <span class="n">Heater</span><span class="p">,</span>
                                      <span class="n">StoichiometricReactor</span><span class="p">,</span>
                                      <span class="n">Product</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">idaes.core.solvers</span> <span class="kn">import</span> <span class="n">get_solver</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.model_statistics</span> <span class="kn">import</span> <span class="n">degrees_of_freedom</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.initialization</span> <span class="kn">import</span> <span class="n">propagate_state</span>
</pre></div>
</div>
</section>
<section id="importing-required-thermophysical-and-reaction-packages">
<h2>Importing Required Thermophysical and Reaction Packages<a class="headerlink" href="#importing-required-thermophysical-and-reaction-packages" title="Permalink to this heading">¶</a></h2>
<p>The final step is to import the thermophysical and reaction packages. We
have created a custom thermophysical package that support ideal vapor
and liquid behavior for this system, and in this case we will restrict
it to ideal liquid behavior only.</p>
<p>Let us import the following modules from the same directory as this
Jupyter notebook: - egprod_ideal as thermo_props - egprod_reaction as
reaction_props</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">egprod_ideal</span> <span class="k">as</span> <span class="nn">thermo_props</span>
<span class="kn">import</span> <span class="nn">egprod_reaction</span> <span class="k">as</span> <span class="nn">reaction_props</span>
</pre></div>
</div>
</section>
<section id="constructing-the-flowsheet">
<h2>Constructing the Flowsheet<a class="headerlink" href="#constructing-the-flowsheet" title="Permalink to this heading">¶</a></h2>
<p>We have now imported all the components, unit models, and property
modules we need to construct a flowsheet. Let us create a ConcreteModel
and add the flowsheet block.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">FlowsheetBlock</span><span class="p">(</span><span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>We now need to add the property packages to the flowsheet. Unlike the
basic <a class="reference external" href="http://localhost:8888/notebooks/GitHub/examples-pse/src/Tutorials/Basics/flash_unit_solution_testing.ipynb">Flash unit model
example</a>,
where we only had a thermophysical property package, for this flowsheet
we will also need to add a reaction property package. We will use the
<a class="reference external" href="https://idaes-pse.readthedocs.io/en/stable/explanations/components/property_package/index.html#generic-property-package-framework">Modular Property
Framework</a>
and <a class="reference external" href="https://idaes-pse.readthedocs.io/en/stable/explanations/components/property_package/index.html#generic-reaction-package-framework">Modular Reaction
Framework</a>.
The get_prop method for the natural gas property module automatically
returns the correct dictionary using a component list argument. The
GenericParameterBlock and GenericReactionParameterBlock methods build
states blocks from passed parameter data; the reaction block unpacks
using **reaction_props.config_dict to allow for optional or empty
keyword arguments:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span> <span class="o">=</span> <span class="n">GenericParameterBlock</span><span class="p">(</span><span class="o">**</span><span class="n">thermo_props</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">reaction_params</span> <span class="o">=</span> <span class="n">GenericReactionParameterBlock</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">,</span>
                                                     <span class="o">**</span><span class="n">reaction_props</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adding-unit-models">
<h2>Adding Unit Models<a class="headerlink" href="#adding-unit-models" title="Permalink to this heading">¶</a></h2>
<p>Let us start adding the unit models we have imported to the flowsheet.
Here, we are adding a <code class="docutils literal notranslate"><span class="pre">Mixer</span></code>, a <code class="docutils literal notranslate"><span class="pre">Heater</span></code> and a
<code class="docutils literal notranslate"><span class="pre">StoichiometricReactor</span></code>. Note that all unit models need to be given a
property package argument. In addition to that, there are several
arguments depending on the unit model, please refer to the documentation
for more details on <a class="reference external" href="https://idaes-pse.readthedocs.io/en/stable/reference_guides/model_libraries/index.html">IDAES Unit
Models</a>.
For example, the <code class="docutils literal notranslate"><span class="pre">Mixer</span></code> is given a <code class="docutils literal notranslate"><span class="pre">list</span></code> consisting of names to
the two inlets.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span> <span class="o">=</span> <span class="n">Feed</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span> <span class="o">=</span> <span class="n">Feed</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span> <span class="o">=</span> <span class="n">Mixer</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">,</span>
                  <span class="n">inlet_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reagent_feed&quot;</span><span class="p">,</span> <span class="s2">&quot;catalyst_feed&quot;</span><span class="p">])</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span> <span class="o">=</span> <span class="n">Heater</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">,</span>
                   <span class="n">has_pressure_change</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">has_phase_equilibrium</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span> <span class="o">=</span> <span class="n">StoichiometricReactor</span><span class="p">(</span><span class="n">property_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="p">,</span>
                                  <span class="n">reaction_package</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">reaction_params</span><span class="p">,</span>
                                  <span class="n">has_heat_of_reaction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">has_heat_transfer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">has_pressure_change</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="connecting-unit-models-using-arcs">
<h2>Connecting Unit Models Using Arcs<a class="headerlink" href="#connecting-unit-models-using-arcs" title="Permalink to this heading">¶</a></h2>
<p>We have now added all the unit models we need to the flowsheet. However,
we have not yet specifed how the units are to be connected. To do this,
we will be using the <code class="docutils literal notranslate"><span class="pre">Arc</span></code> which is a pyomo component that takes in
two arguments: <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">destination</span></code>. Let us connect the outlet
of the <code class="docutils literal notranslate"><span class="pre">Mixer</span></code> to the inlet of the <code class="docutils literal notranslate"><span class="pre">Heater</span></code>, and the outlet of the
<code class="docutils literal notranslate"><span class="pre">Heater</span></code> to the inlet of the <code class="docutils literal notranslate"><span class="pre">StoichiometricReactor</span></code>. Additionally,
we will connect the <code class="docutils literal notranslate"><span class="pre">Feed</span></code> and <code class="docutils literal notranslate"><span class="pre">Product</span></code> blocks to the flowsheet:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s01</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">reagent_feed</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s02</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">catalyst_feed</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s03</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">inlet</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s04</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">inlet</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s05</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">inlet</span><span class="p">)</span>
</pre></div>
</div>
<p>We have now connected the unit model block using the arcs. However, we
also need to link the state variables on connected ports. Pyomo provides
a convenient method <code class="docutils literal notranslate"><span class="pre">TransformationFactory</span></code> to write these equality
constraints for us between two ports:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TransformationFactory</span><span class="p">(</span><span class="s2">&quot;network.expand_arcs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adding-expressions-to-compute-operating-costs">
<h2>Adding Expressions to Compute Operating Costs<a class="headerlink" href="#adding-expressions-to-compute-operating-costs" title="Permalink to this heading">¶</a></h2>
<p>In this section, we will add a few Expressions that allows us to
evaluate the performance. <code class="docutils literal notranslate"><span class="pre">Expressions</span></code> provide a convenient way of
calculating certain values that are a function of the variables defined
in the model. For more details on <code class="docutils literal notranslate"><span class="pre">Expressions</span></code>, please refer to the
<a class="reference external" href="https://pyomo.readthedocs.io/en/latest/pyomo_modeling_components/Expressions.html">Pyomo Expression
documentaiton</a>.</p>
<p>For this flowsheet, we are interested in computing ethylene glycol
production in millions of pounds per year, as well as the total costs
due to cooling and heating utilities.</p>
<p>Let us first add an <code class="docutils literal notranslate"><span class="pre">Expression</span></code> to convert the product flow from
mol/s to MM lb/year of ethylene glycol. We see that the molecular weight
exists in the thermophysical property package, so we may use that value
for our calculations.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">eg_prod</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">inlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_glycol&quot;</span><span class="p">]</span>
                                               <span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">thermo_params</span><span class="o">.</span><span class="n">ethylene_glycol</span><span class="o">.</span><span class="n">mw</span><span class="p">,</span> <span class="c1"># MW defined in properties as kg/mol</span>
                                               <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Mlb</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">yr</span><span class="p">))</span> <span class="c1"># converting kg/s to MM lb/year</span>
</pre></div>
</div>
<p>Now, let us add expressions to compute the reactor cooling cost
(\<span class="math notranslate nohighlight">\(/s) assuming a cost of 2.12E-5 \\\)</span>/kW, and the heating
utility cost (\<span class="math notranslate nohighlight">\(/s) assuming 2.2E-4 \\\)</span>/kW. Note that the heat
duty is in units of watt (J/s). The total operating cost will be the sum
of the two, expressed in \$/year assuming 8000 operating hours per year
(~10% downtime, which is fairly common for small scale chemical plants):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">cooling_cost</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="mf">2.12e-8</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">heat_duty</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># the reaction is exothermic, so R101 duty is negative</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heating_cost</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="mf">2.2e-7</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">heat_duty</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># the stream must be heated to T_rxn, so H101 duty is positive</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">operating_cost</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">8000</span> <span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">heating_cost</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">cooling_cost</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="fixing-feed-conditions">
<h2>Fixing Feed Conditions<a class="headerlink" href="#fixing-feed-conditions" title="Permalink to this heading">¶</a></h2>
<p>Let us first check how many degrees of freedom exist for this flowsheet
using the <code class="docutils literal notranslate"><span class="pre">degrees_of_freedom</span></code> tool we imported earlier. We expect
each stream to have 6 degrees of freedom, the mixer to have 0 (after
both streams are accounted for), the heater to have 1 (just the duty,
since the inlet is also the outlet of M101), and the reactor to have 1
(duty or overall conversion, since the inlet is also the outlet of
H101). In this case, the reactor has an extra degree of freedom since we
have not yet defined the yield of the sole rate-kinetics reaction.
Therefore, we have 15 degrees of freedom to specify: temperature,
pressure and flow of all four components on both streams; outlet heater
temperature; reactor conversion and duty.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">15</span>
</pre></div>
</div>
<p>We will now be fixing the feed stream to the conditions shown in the
flowsheet above. As mentioned in other tutorials, the IDAES framework
expects a time index value for every referenced internal stream or unit
variable, even in steady-state systems with a single time point $ t = 0
$ (<code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">[0]</span></code> is the default when creating a <code class="docutils literal notranslate"><span class="pre">FlowsheetBlock</span></code> without
passing a <code class="docutils literal notranslate"><span class="pre">time_set</span></code> argument). The non-present components in each
stream are assigned a very small non-zero value to help with convergence
and initializing. Based on stoichiometric ratios for the reaction, 80%
conversion and 200 MM lb/year (46.4 mol/s) of ethylene glycol, we will
initialize our simulation with the following calculated values:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_oxide&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">58.0</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">39.6</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># calculated from 16.1 mol EO / cudm in stream</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;sulfuric_acid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e-5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_glycol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e-5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">298.15</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_oxide&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e-5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">200</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;sulfuric_acid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.334</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># calculated from 0.9 wt% SA in stream</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_glycol&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e-5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">298.15</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">1e5</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fixing-unit-model-specifications">
<h2>Fixing Unit Model Specifications<a class="headerlink" href="#fixing-unit-model-specifications" title="Permalink to this heading">¶</a></h2>
<p>Now that we have fixed our inlet feed conditions, we will now be fixing
the operating conditions for the unit models in the flowsheet. Let us
fix the outlet temperature of H101 to 328.15 K.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">328.15</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
<p>We will need to specify both initial reactant extent (conversion or
yield) and heat duty values (these are the only two free variables to
choose from). The reaction extent can be specified directly, as a molar
or mass yield ratio of product to a particular reactant, or fractional
conversion of a particular reactant. Here, we choose fractional
conversion in terms of ethylene oxide. Since heat duty and the outlet
reactor temperature are interdependent, we can choose to specify this
quantity instead. While the reaction kinetic parameters exist in the
property package, we also do not need to add a rate constant expression
since generation is explicitly defined through the conversion/yield.
Note that our initial problem will solve with zero <em>temperature change</em>
but will be infeasible with zero <em>heat duty</em>; this is due to the heat of
reaction enforced by allowing heat transfer and mandating a non-zero
conversion.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">)</span>  <span class="c1"># fraction</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conv_constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
    <span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">inlet</span><span class="o">.</span>
    <span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_oxide&quot;</span><span class="p">]</span> <span class="o">==</span>
    <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">inlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_oxide&quot;</span><span class="p">]</span> <span class="o">-</span>
     <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;ethylene_oxide&quot;</span><span class="p">]))</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.80</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">328.15</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>  <span class="c1"># equal inlet reactor temperature</span>
</pre></div>
</div>
<p>For initialization, we solve a square problem (degrees of freedom = 0).
Let’s check the degrees of freedom below:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span>
</pre></div>
</div>
<p>Finally, we need to initialize the each unit operation in sequence to
solve the flowsheet. As in best practice, unit operations are
initialized or solved, and outlet properties are propagated to connected
inlet streams via arc definitions as follows:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize and solve each unit operation</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">propagate_state</span><span class="p">(</span><span class="n">arc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s01</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">propagate_state</span><span class="p">(</span><span class="n">arc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s01</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">propagate_state</span><span class="p">(</span><span class="n">arc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s03</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">propagate_state</span><span class="p">(</span><span class="n">arc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s04</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">propagate_state</span><span class="p">(</span><span class="n">arc</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">s05</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="c1"># set solver</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">get_solver</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">package</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">OXIDE</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">package</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ACID</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">reagent_feed_state</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">reagent_feed_state</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">catalyst_feed_state</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">catalyst_feed_state</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">mixed_state</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">mixed_state</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="o">.</span><span class="n">mixed_state</span><span class="p">:</span> <span class="n">Property</span> <span class="n">package</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">M101</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_in</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_in</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_out</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_out</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">control_volume</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_in</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_in</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_out</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_out</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">control_volume</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">initialization</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span> <span class="n">Property</span> <span class="n">package</span> <span class="n">initialization</span><span class="p">:</span> <span class="n">optimal</span> <span class="o">-</span> <span class="n">Optimal</span> <span class="n">Solution</span> <span class="n">Found</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">00</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">30</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">idaes</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PROD</span><span class="p">:</span> <span class="n">Initialization</span> <span class="n">Complete</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve the model</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Ipopt 3.13.2: nlp_scaling_method=gradient-based
tol=1e-06
max_iter=200


<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:      337
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      383

Total number of variables............................:       95
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       86
                     variables with only upper bounds:        0
Total number of equality constraints.................:       95
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 1.30e+06 0.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 2.66e+06 1.28e+01  -1.0 9.75e+06    -  6.77e-02 9.90e-01h  1
   2  0.0000000e+00 2.36e+04 2.90e+02  -1.0 9.75e+04    -  7.00e-01 9.90e-01h  1
   3  0.0000000e+00 2.43e+02 1.44e+01  -1.0 9.74e+02    -  9.90e-01 9.90e-01h  1
   4  0.0000000e+00 1.85e+00 3.18e+03  -1.0 9.62e+00    -  9.90e-01 9.92e-01h  1
   5  0.0000000e+00 8.94e-08 3.34e+03  -1.0 7.33e-02    -  9.94e-01 1.00e+00h  1
Cannot recompute multipliers for feasibility problem.  Error in eq_mult_calculator

Number of Iterations....: 5

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   1.6686898422600192e+06    1.6686898422600192e+06
Constraint violation....:   1.9895196601282805e-13    8.9406967163085938e-08
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   1.9895196601282805e-13    1.6686898422600192e+06


Number of objective function evaluations             = 6
Number of objective gradient evaluations             = 6
Number of equality constraint evaluations            = 6
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 6
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 5
Total CPU secs in IPOPT (w/o function evaluations)   =      0.002
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.</pre>
</section>
<section id="analyze-the-results-of-the-square-problem">
<h2>Analyze the Results of the Square Problem<a class="headerlink" href="#analyze-the-results-of-the-square-problem" title="Permalink to this heading">¶</a></h2>
<p>What is the total operating cost?</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;operating cost = $</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">operating_cost</span><span class="p">)</span><span class="o">/</span><span class="mf">1e6</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> million per year&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>operating cost = $3.458 million per year
</pre></div>
</div>
<p>For this operating cost, what conversion did we achieve of ethylene
oxide to ethylene glycol?</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversion achieved = </span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span><span class="p">)</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">====================================================================================</span>
<span class="n">Unit</span> <span class="p">:</span> <span class="n">fs</span><span class="o">.</span><span class="n">R101</span>                                                             <span class="n">Time</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="o">------------------------------------------------------------------------------------</span>
    <span class="n">Unit</span> <span class="n">Performance</span>

    <span class="n">Variables</span><span class="p">:</span>

    <span class="n">Key</span>                  <span class="p">:</span> <span class="n">Value</span>       <span class="p">:</span> <span class="n">Units</span>         <span class="p">:</span> <span class="n">Fixed</span> <span class="p">:</span> <span class="n">Bounds</span>
               <span class="n">Heat</span> <span class="n">Duty</span> <span class="p">:</span> <span class="o">-</span><span class="mf">5.6566e+06</span> <span class="p">:</span>          <span class="n">watt</span> <span class="p">:</span> <span class="kc">False</span> <span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">Reaction</span> <span class="n">Extent</span> <span class="p">[</span><span class="n">R1</span><span class="p">]</span> <span class="p">:</span>      <span class="mf">46.400</span> <span class="p">:</span> <span class="n">mole</span> <span class="o">/</span> <span class="n">second</span> <span class="p">:</span> <span class="kc">False</span> <span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="o">------------------------------------------------------------------------------------</span>
    <span class="n">Stream</span> <span class="n">Table</span>
                                                  <span class="n">Units</span>         <span class="n">Inlet</span>     <span class="n">Outlet</span>
    <span class="n">Molar</span> <span class="n">Flowrate</span> <span class="p">(</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span> <span class="s1">&#39;ethylene_oxide&#39;</span><span class="p">)</span>   <span class="n">mole</span> <span class="o">/</span> <span class="n">second</span>     <span class="mf">58.000</span>     <span class="mf">11.600</span>
    <span class="n">Molar</span> <span class="n">Flowrate</span> <span class="p">(</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">)</span>            <span class="n">mole</span> <span class="o">/</span> <span class="n">second</span>     <span class="mf">239.60</span>     <span class="mf">193.20</span>
    <span class="n">Molar</span> <span class="n">Flowrate</span> <span class="p">(</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span> <span class="s1">&#39;sulfuric_acid&#39;</span><span class="p">)</span>    <span class="n">mole</span> <span class="o">/</span> <span class="n">second</span>    <span class="mf">0.33401</span>    <span class="mf">0.33401</span>
    <span class="n">Molar</span> <span class="n">Flowrate</span> <span class="p">(</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span> <span class="s1">&#39;ethylene_glycol&#39;</span><span class="p">)</span>  <span class="n">mole</span> <span class="o">/</span> <span class="n">second</span> <span class="mf">2.0000e-05</span>     <span class="mf">46.400</span>
    <span class="n">Temperature</span>                                       <span class="n">kelvin</span>     <span class="mf">328.15</span>     <span class="mf">328.15</span>
    <span class="n">Pressure</span>                                          <span class="n">pascal</span> <span class="mf">1.0000e+05</span> <span class="mf">1.0000e+05</span>
<span class="o">====================================================================================</span>

<span class="n">Conversion</span> <span class="n">achieved</span> <span class="o">=</span> <span class="mf">80.0</span><span class="o">%</span>
</pre></div>
</div>
</section>
<section id="optimizing-ethylene-glycol-production">
<h2>Optimizing Ethylene Glycol Production<a class="headerlink" href="#optimizing-ethylene-glycol-production" title="Permalink to this heading">¶</a></h2>
<p>Now that the flowsheet has been squared and solved, we can run a small
optimization problem to minimize our production costs. Suppose we
require at least 200 million pounds/year of ethylene glycol produced and
90% conversion of ethylene oxide, allowing for variable and reactor
temperature (heater outlet).</p>
<p>Let us declare our objective function for this problem.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">operating_cost</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we need to add the design constraints and unfix the decision
variables as we had solved a square problem (degrees of freedom = 0)
until now, as well as set bounds for the design variables (reactor
outlet temperature is set by state variable bounds in property package):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">eg_prod_con</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">eg_prod</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Mlb</span><span class="o">/</span><span class="n">pyunits</span><span class="o">.</span><span class="n">yr</span><span class="p">)</span>  <span class="c1"># MM lb/year</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.90</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setlb</span><span class="p">(</span><span class="mf">328.15</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mf">470.45</span><span class="o">*</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>  <span class="c1"># highest component boiling point (ethylene glycol)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
</pre></div>
</div>
<p>We have now defined the optimization problem and we are now ready to
solve this problem.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Ipopt 3.13.2: nlp_scaling_method=gradient-based
tol=1e-06
max_iter=200


<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:      341
Number of nonzeros in inequality constraint Jacobian.:        1
Number of nonzeros in Lagrangian Hessian.............:      403

Total number of variables............................:       97
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       88
                     variables with only upper bounds:        0
Total number of equality constraints.................:       95
Total number of inequality constraints...............:        1
        inequality constraints with only lower bounds:        1
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  3.4581399e+06 1.76e+06 6.34e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  3.4605363e+06 1.75e+06 1.17e+01  -1.0 6.95e+05    -  7.82e-02 6.15e-03h  1
   2  3.4956495e+06 1.61e+06 6.65e+01  -1.0 6.94e+05    -  1.27e-01 8.29e-02h  1
   3  3.5669528e+06 1.31e+06 4.78e+02  -1.0 6.33e+05    -  1.61e-01 1.84e-01h  1
   4  3.6648118e+06 9.11e+05 3.39e+02  -1.0 5.26e+05    -  9.11e-01 3.05e-01h  1
   5  3.8858215e+06 1.14e+04 1.07e+01  -1.0 3.65e+05    -  9.88e-01 9.90e-01h  1
   6  3.8880314e+06 1.02e+02 2.00e+00  -1.0 3.65e+03    -  9.90e-01 9.91e-01h  1
   7  3.8880511e+06 4.13e-05 1.64e-03  -1.0 3.23e+01    -  1.00e+00 1.00e+00h  1
   8  3.8880508e+06 2.06e-06 1.09e+01  -5.7 3.42e-01    -  1.00e+00 1.00e+00f  1
   9  3.8880508e+06 2.05e-08 3.69e-07  -5.7 2.15e-05    -  1.00e+00 1.00e+00f  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  3.8880508e+06 4.66e-09 4.00e-07  -7.0 6.02e-06    -  1.00e+00 1.00e+00f  1

Number of Iterations....: 10

                                   (scaled)                 (unscaled)
Objective...............:   3.8880508414204163e+06    3.8880508414204163e+06
Dual infeasibility......:   4.0007411785832306e-07    4.0007411785832306e-07
Constraint violation....:   7.1054273576010019e-15    4.6566128730773926e-09
Complementarity.........:   9.0909183706024063e-08    9.0909183706024063e-08
Overall NLP error.......:   9.0909183706024063e-08    4.0007411785832306e-07


Number of objective function evaluations             = 11
Number of objective gradient evaluations             = 11
Number of equality constraint evaluations            = 11
Number of inequality constraint evaluations          = 11
Number of equality constraint Jacobian evaluations   = 11
Number of inequality constraint Jacobian evaluations = 11
Number of Lagrangian Hessian evaluations             = 10
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.001

EXIT: Optimal Solution Found.</pre>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;operating cost = $</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">operating_cost</span><span class="p">)</span><span class="o">/</span><span class="mf">1e6</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> million per year&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Heater results&#39;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stoichiometric reactor results&#39;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>operating cost = $3.888 million per year

Heater results

====================================================================================
Unit : fs.H101                                                             Time: 0.0
------------------------------------------------------------------------------------
    Unit Performance

    Variables:

    Key       : Value  : Units : Fixed : Bounds
    Heat Duty : 699.26 :  watt : False : (None, None)

------------------------------------------------------------------------------------
    Stream Table
                                                  Units         Inlet     Outlet
    Molar Flowrate (&#39;Liq&#39;, &#39;ethylene_oxide&#39;)   mole / second     58.000     58.000
    Molar Flowrate (&#39;Liq&#39;, &#39;water&#39;)            mole / second     239.60     239.60
    Molar Flowrate (&#39;Liq&#39;, &#39;sulfuric_acid&#39;)    mole / second    0.33401    0.33401
    Molar Flowrate (&#39;Liq&#39;, &#39;ethylene_glycol&#39;)  mole / second 2.0000e-05 2.0000e-05
    Temperature                                       kelvin     298.15     328.15
    Pressure                                          pascal 1.0000e+05 1.0000e+05
====================================================================================

Stoichiometric reactor results

====================================================================================
Unit : fs.R101                                                             Time: 0.0
------------------------------------------------------------------------------------
    Unit Performance

    Variables:

    Key                  : Value       : Units         : Fixed : Bounds
               Heat Duty : -6.3608e+06 :          watt : False : (None, None)
    Reaction Extent [R1] :      52.200 : mole / second : False : (None, None)

------------------------------------------------------------------------------------
    Stream Table
                                                  Units         Inlet     Outlet
    Molar Flowrate (&#39;Liq&#39;, &#39;ethylene_oxide&#39;)   mole / second     58.000     5.8000
    Molar Flowrate (&#39;Liq&#39;, &#39;water&#39;)            mole / second     239.60     187.40
    Molar Flowrate (&#39;Liq&#39;, &#39;sulfuric_acid&#39;)    mole / second    0.33401    0.33401
    Molar Flowrate (&#39;Liq&#39;, &#39;ethylene_glycol&#39;)  mole / second 2.0000e-05     52.200
    Temperature                                       kelvin     328.15     450.00
    Pressure                                          pascal 1.0000e+05 1.0000e+05
====================================================================================
</pre></div>
</div>
<p>Display optimal values for the decision variables and design variables:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal Values&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;H101 outlet temperature = </span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> K&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R101 outlet temperature = </span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">outlet</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> K&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ethylene glycol produced = </span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">eg_prod</span><span class="p">)</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> MM lb/year&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversion achieved = </span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">R101</span><span class="o">.</span><span class="n">conversion</span><span class="p">)</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Optimal</span> <span class="n">Values</span>

<span class="n">H101</span> <span class="n">outlet</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mf">328.150</span> <span class="n">K</span>

<span class="n">R101</span> <span class="n">outlet</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mf">450.000</span> <span class="n">K</span>

<span class="n">Ethylene</span> <span class="n">glycol</span> <span class="n">produced</span> <span class="o">=</span> <span class="mf">225.415</span> <span class="n">MM</span> <span class="n">lb</span><span class="o">/</span><span class="n">year</span>

<span class="n">Conversion</span> <span class="n">achieved</span> <span class="o">=</span> <span class="mf">90.0</span><span class="o">%</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright DOE Institute for the Design of Advanced Energy Systems (IDAES), 2018-2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div id="bottombanner">
    The IDAES team:
    <ul>
        <li>National Energy Technology Laboratory (Lead)</li>
        <li>Sandia National Laboratory</li>
        <li>Lawrence Berkeley National Laboratory</li>
        <li>Carnegie-Mellon University (subcontract to LBNL)</li>
        <li>West Virginia University (subcontract to LBNL)</li>
    </ul>
    <div id="contactinfo">
        General, background and overview information<br/> is available at the
        <a href="https://www.idaes.org>">IDAES main website</a>
    </div>
</div>


</body>
</html>