

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Data Reconciliation of a Supercritical Coal-Fired Boiler, Flowsheet Example &mdash; IDAES v1.9.0rc0 Examples</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<!-- Add Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Arimo|Roboto&display=swap"
      rel="stylesheet">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> IDAES Examples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/index.html">IDAES Tutorials</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDAES Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Data Reconciliation of a Supercritical Coal-Fired Boiler, Flowsheet Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/Examples/Advanced/DataRecon/boiler_flowsheet_recon.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-reconciliation-of-a-supercritical-coal-fired-boiler-flowsheet-example">
<h1>Data Reconciliation of a Supercritical Coal-Fired Boiler, Flowsheet Example<a class="headerlink" href="#data-reconciliation-of-a-supercritical-coal-fired-boiler-flowsheet-example" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates data reconciliation with a flowsheet heat
exchanger network, the boiler subflowsheet consist of an economizer,
water wall, primary superheater, platen superheater, finishing
superheater, and reheater. Data for this example was generated by adding
noise to supercritical power plant simulations.</p>
<div class="section" id="why-reconcile-data">
<h2>Why reconcile data?<a class="headerlink" href="#why-reconcile-data" title="Permalink to this headline">¶</a></h2>
<p>Data reconciliation uses mass and energy balances along with redundant
measurements to improve data quality by:</p>
<ol class="arabic simple">
<li><p>reducing measurement error,</p></li>
<li><p>ensuring measurements satisfy mass and energy balances, and</p></li>
<li><p>filling in unmeasured quantities.</p></li>
</ol>
<p>Data reconciliation is used to refine process data before parameter
estimation.</p>
<div class="section" id="read-plant-data">
<h3>1. Read Plant Data<a class="headerlink" href="#read-plant-data" title="Permalink to this headline">¶</a></h3>
<p>The first step is to read in process data. In this case, data was
simulated by adding measurement error to supercritical steam cycle
simulation results. IDAES includes functions to read process data,
convert units to match the models, and map data to the model.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IDAES module with functions to read, analyze and visualize plant data</span>
<span class="kn">import</span> <span class="nn">idaes.dmf.model_data</span> <span class="k">as</span> <span class="nn">da</span>
</pre></div>
</div>
<p>Process data is contained in two csv files, a data file and a metadata
file. The data file where the first column is row indexes and the first
row is process measurement tags. The index column has an entry for each
data row, and is often a timestamp. The metadata file contains
information about the tags including units of measurement, description,
and model mapping information.</p>
<p>Once the process data is read in, the data is assigned to bins based on
the value in a given column, in this case gross power. Dividing the data
into bins allows rough estimation of measurement uncertainty.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in data and column metadata</span>
<span class="n">df</span><span class="p">,</span> <span class="n">df_meta</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="s2">&quot;plant_data.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_data_meta.csv&quot;</span><span class="p">)</span>
<span class="c1"># Add bin information where the data is sorted into 5 MW bins based on the &quot;GROSS_POWER&quot; column</span>
<span class="n">bin_count</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">bin_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">bin_by</span><span class="o">=</span><span class="s2">&quot;POWER_GROSS&quot;</span><span class="p">,</span> <span class="n">bin_no</span><span class="o">=</span><span class="s2">&quot;bin_no&quot;</span><span class="p">,</span> <span class="n">bin_nom</span><span class="o">=</span><span class="s2">&quot;bin_power&quot;</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mf">5e6</span><span class="p">)</span>
<span class="c1"># Calculate the standard deviation by bin for each column</span>
<span class="n">bin_stdev</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">bin_stdev</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">bin_no</span><span class="o">=</span><span class="s2">&quot;bin_no&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It can be useful to visualize the measurement data and estimated
uncertainty. The following creates box and whisker plots for each tag
based on the data bins.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a pdf book of plots that shows box and whisker plots for each column by bin</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;data_plot_book.pdf&quot;</span><span class="p">):</span>
    <span class="n">da</span><span class="o">.</span><span class="n">data_plot_book</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">&quot;data_plot_book.pdf&quot;</span><span class="p">,</span> <span class="n">bin_nom</span><span class="o">=</span><span class="s2">&quot;bin_power&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;gross power (W)&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">df_meta</span><span class="p">)</span>
<span class="c1"># There should now be a data_plot_book.pdf file in this directory</span>
</pre></div>
</div>
</div>
<div class="section" id="boiler-flowsheet-setup">
<h3>2. Boiler Flowsheet Setup<a class="headerlink" href="#boiler-flowsheet-setup" title="Permalink to this headline">¶</a></h3>
<p>Now that we have the plant data, we need to create the flowsheet model
that we can use for data reconciliation. Although we need a model that
has just mass and energy balances and feasibility constraints for the
data reconciliation problem, we start with the boiler flowsheet model
here. Using the same model for data reconciliation, parameter
estimation, validation, and simulation reduces the work required to move
between steps in the workflow.</p>
<p>Once the full flowsheet model is created, constraints that are not
needed for data reconciliation can be deactivated.</p>
</div>
</div>
<div class="section" id="case-study">
<h2>2.1 Case Study:<a class="headerlink" href="#case-study" title="Permalink to this headline">¶</a></h2>
<p>In a supercritical coal-fired power plant, the boiler sub-system
consists of multiple heat exchangers transferring heat from the
combustion side to the water/steam side. The boiler system for this work
(Figure 1) is based on a 550 MWe supercritical power plant. Note that
water wall and platen superheater are modeled as a heater, while the
rest of the units correspond to the shell and tube heat exchangers. Note
that boiler flowsheet block diagram shows the available measurements
from plant data. *for demonstration purposes “plant data” has been
trained at different operating loads and with noise.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import pyomo and idaes libraries</span>
<span class="c1"># import idaes flowsheet object</span>
<span class="kn">from</span> <span class="nn">idaes.core</span> <span class="kn">import</span> <span class="n">FlowsheetBlock</span>
<span class="c1"># import flue gas property package</span>
<span class="kn">from</span> <span class="nn">idaes.power_generation.properties.flue_gas_ideal</span> <span class="kn">import</span> <span class="n">FlueGasParameterBlock</span>
<span class="kn">from</span> <span class="nn">idaes.core.util</span> <span class="kn">import</span> <span class="n">model_serializer</span> <span class="k">as</span> <span class="n">ms</span>
<span class="c1"># import utility to report degrees of freedom</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.model_statistics</span> <span class="kn">import</span> <span class="n">degrees_of_freedom</span>
<span class="c1"># import water/steam property package and functions to calculate enthalpy</span>
<span class="kn">from</span> <span class="nn">idaes.generic_models.properties</span> <span class="kn">import</span> <span class="n">iapws95</span>
<span class="c1"># import unit models from power generation library</span>
<span class="kn">from</span> <span class="nn">idaes.power_generation.unit_models.boiler_heat_exchanger</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BoilerHeatExchanger</span><span class="p">,</span>
    <span class="n">TubeArrangement</span><span class="p">,</span>
    <span class="n">DeltaTMethod</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="c1"># import methods to build the flowsheet and deactivate performance constraints</span>
<span class="kn">import</span> <span class="nn">boiler_data_rec</span> <span class="k">as</span> <span class="nn">flowsheet</span>
</pre></div>
</div>
</div>
<div class="section" id="flowsheet-setup">
<h2>2.2 Flowsheet Setup<a class="headerlink" href="#flowsheet-setup" title="Permalink to this headline">¶</a></h2>
<p>The “boiler_flowsheet” method imports all the unit models in the boiler
heat exchanger network, builds the flowsheet, builds the flowsheet
connectivity, and initializes the flowsheet.</p>
<p>The final solve corresponds to a simulation case, with the following
inputs (relative to a ~650 MW case): - Econommizer (water): F, h, P -
Reheater Inlet (Cold Reheat steam): F, h, P - Coal flowrate (kg/s) and
stoichiometric ratio (unitless) - Dimensions of all units (tube
diameter, # tubes, hx area, etc.)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create boiler flowsheet, the main unit models are:</span>
<span class="c1"># heat exchanger model: economizer, primary super heater, finishing superheater, and reheater</span>
<span class="c1"># heater model: water wall and platen superheater</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">flowsheet</span><span class="o">.</span><span class="n">boiler_flowsheet</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">57072.56349970795
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_1: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_2.properties_in: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_2.properties_out: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_2.properties_out: fs.ECON.side_2.properties_out State Released.
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_2: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON: fs.ECON Initialisation Step 1 Complete.
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON.side_2.properties_in: fs.ECON.side_2.properties_in State Released.
2021-02-25 10:24:28 [INFO] idaes.init.fs.ECON: fs.ECON Initialisation Complete.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_1: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_2.properties_in: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_2.properties_out: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_2.properties_out: fs.PrSH.side_2.properties_out State Released.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_2: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH: fs.PrSH Initialisation Step 1 Complete.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH.side_2.properties_in: fs.PrSH.side_2.properties_in State Released.
2021-02-25 10:24:28 [INFO] idaes.init.fs.PrSH: fs.PrSH Initialisation Complete.
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH.side_1: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH.side_2.properties_in: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH.side_2.properties_out: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH.side_2.properties_out: fs.FSH.side_2.properties_out State Released.
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH.side_2: Initialization Complete
2021-02-25 10:24:28 [INFO] idaes.init.fs.FSH: fs.FSH Initialisation Step 1 Complete.
2021-02-25 10:24:29 [INFO] idaes.init.fs.FSH.side_2.properties_in: fs.FSH.side_2.properties_in State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.FSH: fs.FSH Initialisation Complete.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_1: Initialization Complete
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_2.properties_in: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_2.properties_out: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_2.properties_out: fs.RH.side_2.properties_out State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_2: Initialization Complete
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH: fs.RH Initialisation Step 1 Complete.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH.side_2.properties_in: fs.RH.side_2.properties_in State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.RH: fs.RH Initialisation Complete.
2021-02-25 10:24:29 [INFO] idaes.init.fs.PlSH.control_volume: Initialization Complete
2021-02-25 10:24:29 [INFO] idaes.init.fs.PlSH: Initialization Complete: optimal - Optimal Solution Found
2021-02-25 10:24:29 [INFO] idaes.init.fs.Water_wall.control_volume: Initialization Complete
2021-02-25 10:24:29 [INFO] idaes.init.fs.Water_wall: Initialization Complete: optimal - Optimal Solution Found
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.mixed_state: Initialisation Complete, skipped.
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.outlet_1_state: Initialisation Complete, skipped.
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.outlet_1_state: fs.Spl1.outlet_1_state State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.outlet_2_state: Initialisation Complete, skipped.
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.outlet_2_state: fs.Spl1.outlet_2_state State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1: Initialization Step 2 Complete: optimal - Optimal Solution Found
2021-02-25 10:24:29 [INFO] idaes.init.fs.Spl1.mixed_state: fs.Spl1.mixed_state State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.mix1.Reheat_out_state: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:29 [INFO] idaes.init.fs.mix1.PrSH_out_state: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:29 [INFO] idaes.init.fs.mix1.mixed_state: Initialisation Complete, optimal - Optimal Solution Found.
2021-02-25 10:24:29 [INFO] idaes.init.fs.mix1.mixed_state: fs.mix1.mixed_state State Released.
2021-02-25 10:24:29 [INFO] idaes.init.fs.mix1: Initialization Complete: optimal - Optimal Solution Found
2021-02-25 10:24:29 [INFO] idaes.init.fs.ATMP1: Initialization Complete: optimal - Optimal Solution Found
initialization done
Ipopt 3.13.2:

<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1177
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      995

Total number of variables............................:      330
                     variables with only lower bounds:        0
                variables with lower and upper bounds:      128
                     variables with only upper bounds:        0
Total number of equality constraints.................:      330
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 1.44e+06 0.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 3.07e+06 1.39e+06  -1.0 2.77e+07    -  7.13e-01 1.00e+00h  1
   2  0.0000000e+00 3.23e+03 6.16e+04  -1.0 6.67e+05    -  9.70e-01 1.00e+00h  1
   3  0.0000000e+00 1.22e-01 4.22e+01  -1.0 1.63e+04    -  9.90e-01 1.00e+00h  1
   4  0.0000000e+00 8.70e-05 3.52e-03  -1.0 7.50e+02    -  9.90e-01 1.00e+00h  1
   5  0.0000000e+00 7.12e-07 1.63e-08  -1.0 2.31e-02    -  9.90e-01 1.00e+00h  1
Cannot recompute multipliers for feasibility problem.  Error in eq_mult_calculator

Number of Iterations....: 5

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   3.1312476275258273e-02    3.1312476275258273e-02
Constraint violation....:   3.9099028722227669e-10    7.1153044700622559e-07
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   3.9099028722227669e-10    3.1312476275258273e-02


Number of objective function evaluations             = 6
Number of objective gradient evaluations             = 6
Number of equality constraint evaluations            = 6
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 6
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 5
Total CPU secs in IPOPT (w/o function evaluations)   =      0.027
Total CPU secs in NLP function evaluations           =      0.094

EXIT: Optimal Solution Found.

Problem:
- Lower bound: -inf
  Upper bound: inf
  Number of objectives: 1
  Number of constraints: 330
  Number of variables: 330
  Sense: unknown
Solver:
- Status: ok
  Message: Ipopt 3.13.2x3a Optimal Solution Found
  Termination condition: optimal
  Id: 0
  Error rc: 0
  Time: 0.14410924911499023
Solution:
- number of solutions: 0
  number of solutions displayed: 0

degrees of freedom = 0</pre>
<div class="section" id="simplify-to-mass-and-energy-balances">
<h3>3. Simplify to Mass and Energy Balances<a class="headerlink" href="#simplify-to-mass-and-energy-balances" title="Permalink to this headline">¶</a></h3>
<p>For data reconciliation, the flowsheet model should be reduced to mass
and energy balances and potentially limited performance constraints to
keep the results feasible.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Deactivate constraints for heat transfer (for all heat exchanger units)</span>
<span class="c1"># for example to deactivate heat trasnfer calculation in the economizer we include:</span>
<span class="c1"># m.fs.ECON.overall_heat_transfer_coefficient_eqn.deactivate()</span>

<span class="c1"># The method &quot;deactivate_performance_constraints&quot; deactivates the equations for all</span>
<span class="c1"># heat exchangers in this flowsheet (Economizer, Primary Superheater,</span>
<span class="c1">#                                    Finishing Superheater, Reheater)</span>
<span class="n">flowsheet</span><span class="o">.</span><span class="n">deactivate_performance_constraints</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Now the model has 12 DoF</span>
<span class="c1"># deltaP shell and tube, and U - overall heat transfer coefficient in 4 hx models</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">degrees</span> <span class="n">of</span> <span class="n">freedom</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="section" id="map-data-to-the-model">
<h3>4. Map Data to the Model<a class="headerlink" href="#map-data-to-the-model" title="Permalink to this headline">¶</a></h3>
<p>Although the model mapping can be added to the tag metadata file, here
we just add the mapping information to the tag metadata after reading
the data.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Water/Steam Measurements ----------------------------------------------- #</span>
<span class="c1"># Economizer inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;BFW_F&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_in[:].flow_mol&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;BFW_T&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;BFW_P&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_in[:].pressure&quot;</span>

<span class="c1"># Economizer outputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;ECON_OUT_T&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;ECON_OUT_P&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_out[:].pressure&quot;</span>

<span class="c1"># Reheater inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_COLD_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_COLD_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_in[:].pressure&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_COLD_F&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_in[:].flow_mol&quot;</span>

<span class="c1"># Reheater outputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_HOT_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_HOT_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_out[:].pressure&quot;</span>

<span class="c1"># primary SH outlet</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;PlatenSH_IN_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_1.properties_out[:].pressure&quot;</span>

<span class="c1"># Platen SH outlet inlet to Finishing SH</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FSH_In_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_1.properties_in[:].pressure&quot;</span>

<span class="c1"># Finishing SH outlet ----------------------------------------------------- #</span>
<span class="c1"># Main Steam</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;MS_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ATMP1.mixed_state[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;MS_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ATMP1.mixed_state[:].pressure&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;MS_F&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ATMP1.mixed_state[:].flow_mol&quot;</span>

<span class="c1"># Flue Gas measurements</span>
<span class="c1"># Finishing inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_FSH_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.FSH.side_2.properties_in[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_FSH_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.FSH.side_2.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_FSH_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.FSH.side_2.properties_in[:].pressure&quot;</span>

<span class="c1"># Reheater inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_RH_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_RH_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_in[:].pressure&quot;</span>

<span class="c1"># Primary SH inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_PrSH_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_in[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_PrSH_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_PrSH_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_in[:].pressure&quot;</span>

<span class="c1"># Economizer inputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_ECON_P&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].pressure&quot;</span>

<span class="c1"># Economizer outputs</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_AIRPH_T&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_AIRPH_P&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].pressure&quot;</span>

<span class="c1"># --------------------------------------------------------------------------------------- #</span>
<span class="c1"># Other inputs available in the data set (but not used as measurements in this study)</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;ECON_OUT_F&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_1.properties_out[:].flow_mol&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;RHT_HOT_F&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_1.properties_out[:].flow_mol&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_RH_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_in[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_ECON_Fm&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_ECON_T&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s2">&quot;FG_2_AIRPH_Fm&quot;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].flow_mass&quot;</span>

<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_RH_2_Mix_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_out[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_RH_2_Mix_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_RH_2_Mix_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.RH.side_2.properties_out[:].pressure&quot;</span>

<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_PrSH_2_Mix_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_out[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_PrSH_2_Mix_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_PrSH_2_Mix_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.PrSH.side_2.properties_out[:].pressure&quot;</span>

<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_ECON_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_ECON_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_ECON_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_in[:].pressure&quot;</span>

<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_AIRPH_Fm&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].flow_mass&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_AIRPH_T&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].temperature&quot;</span>
<span class="n">df_meta</span><span class="p">[</span><span class="s1">&#39;FG_2_AIRPH_P&#39;</span><span class="p">][</span><span class="s2">&quot;reference_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m.fs.ECON.side_2.properties_out[:].pressure&quot;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the model references to the tag metadata based on the strings above.</span>
<span class="n">da</span><span class="o">.</span><span class="n">upadate_metadata_model_references</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary of data tags that we want to use for the data reconciliation problem.</span>
<span class="c1"># The key is the tag and the value is a reference to a quantity in the model.</span>
<span class="n">data_tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The output from the data reconciliation step usually gives full stream information</span>
<span class="c1"># for a flowsheet including quantities that are unmeasured. To use the results more easily,</span>
<span class="c1"># it is good practice to map most of the data reconciliation results to flowsheet stream names.</span>
<span class="kn">import</span> <span class="nn">idaes.core.util.tables</span> <span class="k">as</span> <span class="nn">ta</span>

<span class="n">stream_dict</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">arcs_to_stream_dict</span><span class="p">(</span>
    <span class="n">m</span><span class="p">,</span>
    <span class="n">additional</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;MS&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ATMP1</span><span class="o">.</span><span class="n">mixed_state</span><span class="p">,</span>
        <span class="s1">&#39;ATMP_In&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_out</span><span class="p">,</span>
        <span class="s1">&#39;FSH_In&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
        <span class="s1">&#39;PrSH_IN&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PrSH</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
        <span class="s1">&#39;RHT_COLD&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RH</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
        <span class="s1">&#39;RHT_HOT&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RH</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_out</span><span class="p">,</span>
        <span class="s1">&#39;PlatenSH_IN&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PlSH</span><span class="o">.</span><span class="n">control_volume</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
        <span class="s1">&#39;BFW&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ECON</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
        <span class="s1">&#39;ECON_OUT&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ECON</span><span class="o">.</span><span class="n">side_1</span><span class="o">.</span><span class="n">properties_out</span><span class="p">,</span>
        <span class="s1">&#39;FG_2_FSH&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_2</span><span class="o">.</span><span class="n">properties_in</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">state_dict</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">stream_states_dict</span><span class="p">(</span><span class="n">stream_dict</span><span class="p">,</span> <span class="n">time_point</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">recon_tags</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">tag_state_quantities</span><span class="p">(</span>
    <span class="n">blocks</span><span class="o">=</span><span class="n">state_dict</span><span class="p">,</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;flow_mass&quot;</span><span class="p">,</span>
        <span class="s2">&quot;flow_mol&quot;</span><span class="p">,</span>
        <span class="s2">&quot;enth_mol&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;O2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;N2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;SO2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;flow_mol_comp&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_Fm&quot;</span><span class="p">,</span> <span class="s2">&quot;_F&quot;</span><span class="p">,</span> <span class="s2">&quot;_h&quot;</span><span class="p">,</span> <span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="s2">&quot;_P&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[O2]&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[NO]&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[N2]&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[SO2]&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[CO2]&quot;</span><span class="p">,</span> <span class="s2">&quot;_F[H2O]&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># add additional model variables</span>
<span class="n">recon_tags</span><span class="p">[</span><span class="s2">&quot;coal_flow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">coal_flow</span>
<span class="n">recon_tags</span><span class="p">[</span><span class="s2">&quot;stoich_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">SR</span>
</pre></div>
</div>
</div>
<div class="section" id="view-model-flowsheet">
<h3>5. View Model Flowsheet<a class="headerlink" href="#view-model-flowsheet" title="Permalink to this headline">¶</a></h3>
<p>Model results or other quantities can be added to a process flow
diagram. The PFD was drawn beforehand and the model results are added to
tagged locations on the PFD.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">idaes.core.util.misc</span> <span class="kn">import</span> <span class="n">svg_tag</span>  <span class="c1"># utility to place numbers/text in an SVG</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Boiler_scpc_PFD.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">svg_tag</span><span class="p">(</span><span class="n">svg</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;subtitle&quot;</span><span class="p">:</span><span class="s2">&quot;Initialized Model&quot;</span><span class="p">})</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">svg_tag</span><span class="p">(</span><span class="n">svg</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">data_tags</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;boiler_scpc_init.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>

<span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../../../_images/output_20_0.svg" src="../../../_images/output_20_0.svg" /></div>
<div class="section" id="write-objective">
<h3>6. Write Objective<a class="headerlink" href="#write-objective" title="Permalink to this headline">¶</a></h3>
<p>Next we write the objective function and additional constraints for the
data reconciliation problem. The objective is</p>
<div class="math notranslate nohighlight">
\[\min \sum_i \left(\frac{x_{\text{data}, i} - x_{\text{model}, i}}{\sigma_i} \right)^2\]</div>
<p>Where <span class="math notranslate nohighlight">\(i \in \{\text{Measured Quantities}\}\)</span> and <span class="math notranslate nohighlight">\(\sigma_i\)</span>
is the standard deviation of measurement i estimated by binning the
data.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add model parameters to contain measured data.  These are mutable so we can set a specific</span>
<span class="c1"># change to specific data points later.</span>
<span class="n">m</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">data_tags</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Process data for a specific point in time.&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">data_stdev</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">data_tags</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Process data standard deviation.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The &#39;set_data&#39; function below takes data from the model DataFrame and updates the</span>
<span class="c1"># model data parameters.</span>
<span class="c1"># fix tags dictionary is used to fix model inputs to their values in the data set (for each data point)</span>
<span class="c1"># in this case Boiler Feed Water = inlet to economizer and Reheater Cold = Reheater inlet</span>
<span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">data_tags</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indexindex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">indexindex</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">bin_no</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;bin_no&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">data_tags</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
        <span class="n">m</span><span class="o">.</span><span class="n">data_stdev</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_stdev</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">bin_no</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># So we have something reasonable to start, set the data attached to the model to the first</span>
<span class="c1"># data point.</span>
<span class="n">set_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">data_tags</span><span class="p">,</span> <span class="n">indexindex</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Add an expression for error divided by the standard deviation, and use
it to write the data reconciliation objective function.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">tags_obj</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;BFW_F&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BFW_T&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BFW_P&#39;</span><span class="p">,</span>
    <span class="s2">&quot;RHT_COLD_F&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHT_COLD_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHT_COLD_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ECON_OUT_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ECON_OUT_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHT_HOT_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RHT_HOT_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MS_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MS_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_2_ECON_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_2_AIRPH_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_2_AIRPH_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_RH_2_Mix_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_RH_2_Mix_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_RH_2_Mix_Fm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_2_FSH_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_2_FSH_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_PrSH_2_Mix_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_PrSH_2_Mix_P&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FG_PrSH_2_Mix_Fm&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">data_tags</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">err</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_tags</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">m</span><span class="o">.</span><span class="n">data_stdev</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">m</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">err</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">tags_obj</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="solve-optimization">
<h3>7. Solve Optimization<a class="headerlink" href="#solve-optimization" title="Permalink to this headline">¶</a></h3>
<p>Now we need to solve the data reconciliation problem for every data
point. The important results are stored in two DataFrames <code class="docutils literal notranslate"><span class="pre">df_result</span></code>
which contains results tagged based on model stream names to be used in
the parameter estimation step and <code class="docutils literal notranslate"><span class="pre">df_result_cmp</span></code> which contains
reconciled data based on the original measurement tags and can be used
to compare the original measurements to the reconciled results.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add constraints or fix variable bounds to ensure reasonable flowsheet performance (i.e. LMTD, negative pressure drop, etc.).</span>
<span class="c1"># In this case, before solving the data reconciliation problem</span>
<span class="c1"># unfix the coal flowarate, stoichiometric ratio, and split fraction (flue gas to Reheater)</span>

<span class="c1"># Surrogate models have been trained using a rigorous boiler fire side model</span>
<span class="c1"># with fixed wall temperature and variable fuel flowrate and stoichiometric ratio.</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">coal_flow</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">coal_flow</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mf">70.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">coal_flow</span><span class="o">.</span><span class="n">setlb</span><span class="p">(</span><span class="mf">30.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">SR</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span> <span class="c1"># stoichiometric ratio</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Spl1</span><span class="o">.</span><span class="n">split_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;outlet_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>

<span class="c1"># Surrogate models are used for Flue Gas Exit Temperature, flue gas component molar flowrate,</span>
<span class="c1"># and heat duty to the platen superheater and water wall</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_2</span><span class="o">.</span><span class="n">properties_in</span><span class="p">[:]</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_2</span><span class="o">.</span><span class="n">properties_in</span><span class="p">[:]</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_2</span><span class="o">.</span><span class="n">properties_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mi">1800</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FSH</span><span class="o">.</span><span class="n">side_2</span><span class="o">.</span><span class="n">properties_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">setlb</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>

<span class="c1"># unfix flowsheet inlets</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ECON</span><span class="o">.</span><span class="n">side_1_inlet</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RH</span><span class="o">.</span><span class="n">side_1_inlet</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                   <span class="s1">&#39;halt_on_ampl_error&#39;</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">250</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># add bin information to reconciliation results so it can be used in parameter estimation</span>
<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">recon_tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;termination&quot;</span><span class="p">,</span> <span class="s2">&quot;bin_no&quot;</span><span class="p">,</span> <span class="s2">&quot;bin_power&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">df_result_cmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data_tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;termination&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">set_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">data_tags</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tc</span> <span class="o">!=</span> <span class="s1">&#39;optimal&#39;</span><span class="p">:</span>
            <span class="n">ms</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s2">&quot;optimal_run.json.gz&quot;</span><span class="p">)</span>
            <span class="n">set_data</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">data_tags</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span>
    <span class="n">df_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;termination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span>
    <span class="n">df_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;bin_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;bin_no&quot;</span><span class="p">]</span>
    <span class="n">df_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;bin_power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;bin_power&quot;</span><span class="p">]</span>
    <span class="n">df_result_cmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;termination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">recon_tags</span><span class="p">:</span>
        <span class="n">df_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">recon_tags</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">data_tags</span><span class="p">:</span>
        <span class="n">df_result_cmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">data_tags</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">tc</span><span class="si">}</span><span class="s2">, objective: </span><span class="si">{</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># save first solution to be used as initial point</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;optimal_run.json.gz&#39;</span><span class="p">)</span>

    <span class="c1"># break after 10 runs to keep the example short</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="c1"># to see the full results see file boiler_plant_recon.csv</span>
</pre></div>
</div>
<pre class="literal-block">0 -- optimal, objective: 2.7751108345589492
1 -- optimal, objective: 10.131091326989827
2 -- optimal, objective: 3.2791306576646377
3 -- optimal, objective: 6.3432350958250545
4 -- optimal, objective: 7.2490524241830245
5 -- optimal, objective: 4.0762082220298135
6 -- optimal, objective: 1.6712989065192736
WARNING: Loading a SolverResults object with a warning status into
    model.name=&quot;unknown&quot;;
      - termination condition: maxIterations
      - message from solver: Ipopt 3.13.2x3a Maximum Number of Iterations
        Exceeded.
WARNING: Loading a SolverResults object with a warning status into
    model.name=&quot;unknown&quot;;
      - termination condition: maxIterations
      - message from solver: Ipopt 3.13.2x3a Maximum Number of Iterations
        Exceeded.
7 -- maxIterations, objective: 3.5650517519884075
8 -- optimal, objective: 3.5216626052356483
9 -- optimal, objective: 5.54911090026884
10 -- optimal, objective: 3.666515269460752
11 -- optimal, objective: 4.953060397292053</pre>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the reconciled data to be used for parameter estimation</span>
<span class="n">df_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;boiler_plant_recon_short.csv&quot;</span><span class="p">)</span>
<span class="c1"># a smaller subset of data points have been run to keep the simulation time short,</span>
<span class="c1"># however the full set of results can be found in boiler_plant_recon.csv</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assert algorithm works fine</span>
<span class="k">assert</span> <span class="n">df_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;termination&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;optimal&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright DOE Institute for the Design of Advanced Energy Systems (IDAES), 2018-2020.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div id="bottombanner">
    The IDAES team:
    <ul>
        <li>National Energy Technology Laboratory (Lead)</li>
        <li>Sandia National Laboratory</li>
        <li>Lawrence Berkeley National Laboratory</li>
        <li>Carnegie-Mellon University (subcontract to LBNL)</li>
        <li>West Virginia University (subcontract to LBNL)</li>
    </ul>
    <div id="contactinfo">
        General, background and overview information<br/> is available at the
        <a href="https://www.idaes.org>">IDAES main website</a>
    </div>
</div>


</body>
</html>