<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Autothermal Reformer Flowsheet Optimization with OMLT (TensorFlow Keras) Surrogate Object &mdash; IDAES v2.0.0b2 Examples</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<!-- Add Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Arimo|Roboto&display=swap"
      rel="stylesheet">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> IDAES Examples
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/index.html">IDAES Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDAES Examples</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Autothermal Reformer Flowsheet Optimization with OMLT (TensorFlow Keras) Surrogate Object</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Examples/SurrMod/FlowsheetOptimization/Keras_flowsheet_optimization.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="autothermal-reformer-flowsheet-optimization-with-omlt-tensorflow-keras-surrogate-object">
<h1>Autothermal Reformer Flowsheet Optimization with OMLT (TensorFlow Keras) Surrogate Object<a class="headerlink" href="#autothermal-reformer-flowsheet-optimization-with-omlt-tensorflow-keras-surrogate-object" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>This example demonstrates autothermal reformer optimization leveraging
the OMLT package utilizing TensorFlow Keras neural networks. In this
notebook, sampled simulation data will be used to train and validate a
surrogate model. IDAES surrogate plotting tools will be utilized to
visualize the surrogates on training and validation data. Once
validated, integration of the surrogate into an IDAES flowsheet will be
demonstrated.</p>
</section>
</section>
<section id="problem-statement">
<h1>2. Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this heading">¶</a></h1>
<p>Within the context of a larger NGFC system, the autothermal reformer
generates syngas from air, steam and natural gas for use in a
solid-oxide fuel cell (SOFC).</p>
<section id="main-inputs">
<h2>2.1. Main Inputs:<a class="headerlink" href="#main-inputs" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Bypass fraction (dimensionless) - split fraction of natural gas to
bypass AR unit and feed directly to the power island</p></li>
<li><p>NG-Steam Ratio (dimensionless) - proportion of natural relative to
steam fed into AR unit operation</p></li>
</ul>
</section>
<section id="main-outputs">
<h2>2.2. Main Outputs:<a class="headerlink" href="#main-outputs" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Steam flowrate (kg/s) - inlet steam fed to AR unit</p></li>
<li><p>Reformer duty (kW) - required energy input to AR unit</p></li>
<li><p>Composition (dimensionless) - outlet mole fractions of components
(Ar, C2H6, C3H8, C4H10, CH4, CO, CO2, H2, H2O, N2, O2)</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">&quot;AR_PFD.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../../_images/output_3_02.png" src="../../../_images/output_3_02.png" />
</section>
<section id="training-and-validating-surrogates">
<h2>3. Training and Validating Surrogates<a class="headerlink" href="#training-and-validating-surrogates" title="Permalink to this heading">¶</a></h2>
<p>First, let’s import the required Python, Pyomo and IDAES modules:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import statements</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="nn">rn</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="c1"># Import Pyomo libraries</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">ConcreteModel</span><span class="p">,</span> <span class="n">SolverFactory</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> \
    <span class="n">Constraint</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">maximize</span>
<span class="kn">from</span> <span class="nn">pyomo.common.timing</span> <span class="kn">import</span> <span class="n">TicTocTimer</span>

<span class="c1"># Import IDAES libraries</span>
<span class="kn">from</span> <span class="nn">idaes.core.surrogate.sampling.data_utils</span> <span class="kn">import</span> <span class="n">split_training_validation</span>
<span class="kn">from</span> <span class="nn">idaes.core.surrogate.sampling.scaling</span> <span class="kn">import</span> <span class="n">OffsetScaler</span>
<span class="kn">from</span> <span class="nn">idaes.core.surrogate.keras_surrogate</span> <span class="kn">import</span> <span class="n">KerasSurrogate</span><span class="p">,</span> <span class="n">save_keras_json_hd5</span><span class="p">,</span> <span class="n">load_keras_json_hd5</span>
<span class="kn">from</span> <span class="nn">idaes.core.surrogate.plotting.sm_plotter</span> <span class="kn">import</span> <span class="n">surrogate_scatter2D</span><span class="p">,</span> <span class="n">surrogate_parity</span><span class="p">,</span> <span class="n">surrogate_residual</span>
<span class="kn">from</span> <span class="nn">idaes.core.surrogate.surrogate_block</span> <span class="kn">import</span> <span class="n">SurrogateBlock</span>
<span class="kn">from</span> <span class="nn">idaes.core</span> <span class="kn">import</span> <span class="n">FlowsheetBlock</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.convergence.convergence_base</span> <span class="kn">import</span> <span class="n">_run_ipopt_with_stats</span>

<span class="c1"># fix environment variables to ensure consist neural network training</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONHASHSEED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CUDA_VISIBLE_DEVICES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span>
<span class="n">rn</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1342</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">62</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">2022-12-07 19:12:52.859944: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-12-07 19:12:52.981393: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable <cite>TF_ENABLE_ONEDNN_OPTS=0</cite>.
2022-12-07 19:12:52.986471: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2022-12-07 19:12:52.986484: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
2022-12-07 19:12:53.009807: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2022-12-07 19:12:53.536596: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory
2022-12-07 19:12:53.536648: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory
2022-12-07 19:12:53.536654: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.</pre>
</section>
<section id="importing-training-and-validation-datasets">
<h2>3.1 Importing Training and Validation Datasets<a class="headerlink" href="#importing-training-and-validation-datasets" title="Permalink to this heading">¶</a></h2>
<p>In this section, we read the dataset from the CSV file located in this
directory. 2800 data points were simulated from a rigorous IDAES NGFC
flowsheet using a grid sampling method. For simplicity and to reduce
training runtime, this example randomly selects 100 data points to use
for training/validation. The data is separated using an 80/20 split into
training and validation data using the IDAES
<code class="docutils literal notranslate"><span class="pre">split_training_validation()</span></code> method.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Auto-reformer training data</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">csv_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;reformer-data.csv&#39;</span><span class="p">)</span> <span class="c1"># 2800 data points</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># randomly sample points for training/validation</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">output_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>

<span class="c1"># Define labels, and split training and validation data</span>
<span class="n">input_labels</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">columns</span>
<span class="n">output_labels</span> <span class="o">=</span> <span class="n">output_data</span><span class="o">.</span><span class="n">columns</span>

<span class="n">n_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">input_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span>
<span class="n">data_training</span><span class="p">,</span> <span class="n">data_validation</span> <span class="o">=</span> <span class="n">split_training_validation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">n_data</span><span class="p">)</span>  <span class="c1"># seed=100</span>
</pre></div>
</div>
</section>
<section id="training-surrogates-with-tensorflow-keras">
<h2>3.2 Training Surrogates with TensorFlow Keras<a class="headerlink" href="#training-surrogates-with-tensorflow-keras" title="Permalink to this heading">¶</a></h2>
<p>TensorFlow Keras provides an interface to pass regression settings,
build neural networks and train surrogate models. Keras enables the
usage of two API formats: Sequential and Functional. While the
Functional API offers more versatility including multiple input and
output layers in a single neural network, the Sequential API is more
stable and user-friendly. Further, the Sequnetial API integrates cleanly
with existing IDAES surrogate tools and will be utilized in this
example.</p>
<p>In the code below, we build the neural network structure based on our
training data structure and desired regression settings. Offline, neural
network models were trained for the list of settings below and the
options bolded and italicized were determined to have the minimum mean
squared error for the dataset:</p>
<ul class="simple">
<li><p>Activation function: relu, sigmoid, <strong>tanh</strong></p></li>
<li><p>Optimizer: <strong>Adam</strong>, RMSprop, SGD</p></li>
<li><p>Number of hidden layers: 1, <strong>2</strong>, 4</p></li>
<li><p>Number of neurons per layer: 10, 20, <strong>40</strong></p></li>
</ul>
<p>Typically, Sequential Keras models are built vertically; the dataset is
scaled and normalized, and the network is defined for the input layer,
hidden layers and output layer for the passed activation functions and
network/layer sizes. Then, the model is compiled using the passed
optimizer and trained using a desired number of epochs. Keras internally
validates while training and updates the model weight (coefficient)
values on each epoch.</p>
<p>Finally, after training the model we save the results and model
expressions to a folder which contains a serialized JSON file.
Serializing the model in this fashion enables importing a previously
trained set of surrogate models into external flowsheets. This feature
will be used later.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># capture long output (not required to use surrogate API)</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">oldstdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stream</span>

<span class="c1"># selected settings for regression (best fit from options above)</span>
<span class="n">activation</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">n_hidden_layers</span><span class="p">,</span> <span class="n">n_nodes_per_layer</span> <span class="o">=</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;Adam&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">40</span>
<span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="s1">&#39;mse&#39;</span><span class="p">]</span>

<span class="c1"># Create data objects for training using scalar normalization</span>
<span class="n">n_inputs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_labels</span><span class="p">)</span>
<span class="n">n_outputs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_labels</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">input_data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">output_data</span>

<span class="n">input_scaler</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">output_scaler</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">input_scaler</span> <span class="o">=</span> <span class="n">OffsetScaler</span><span class="o">.</span><span class="n">create_normalizing_scaler</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">output_scaler</span> <span class="o">=</span> <span class="n">OffsetScaler</span><span class="o">.</span><span class="n">create_normalizing_scaler</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">input_scaler</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">output_scaler</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># Create Keras Sequential object and build neural network</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">n_nodes_per_layer</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_hidden_layers</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">n_nodes_per_layer</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">))</span>

<span class="c1"># Train surrogate (calls optimizer on neural network and solves for weights)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
<span class="n">mcp_save</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="s1">&#39;.mdl_wts.hdf5&#39;</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">mcp_save</span><span class="p">])</span>

<span class="c1"># save model to JSON and create callable surrogate object</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]</span>
<span class="n">input_bounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">input_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="p">(</span><span class="n">xmin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xmax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_labels</span><span class="p">))}</span>

<span class="n">keras_surrogate</span> <span class="o">=</span> <span class="n">KerasSurrogate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">input_labels</span><span class="p">),</span> <span class="n">output_labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output_labels</span><span class="p">),</span>
                                 <span class="n">input_bounds</span><span class="o">=</span><span class="n">input_bounds</span><span class="p">,</span> <span class="n">input_scaler</span><span class="o">=</span><span class="n">input_scaler</span><span class="p">,</span> <span class="n">output_scaler</span><span class="o">=</span><span class="n">output_scaler</span><span class="p">)</span>
<span class="n">keras_surrogate</span><span class="o">.</span><span class="n">save_to_folder</span><span class="p">(</span><span class="s1">&#39;keras_surrogate&#39;</span><span class="p">)</span>

<span class="c1"># revert back to normal output capture</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">oldstdout</span>

<span class="c1"># display first 50 lines and last 50 lines of output</span>
<span class="n">celloutput</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">celloutput</span><span class="p">[:</span><span class="mi">50</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">celloutput</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">07</span> <span class="mi">19</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">55.813256</span><span class="p">:</span> <span class="n">W</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">64</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">load</span> <span class="n">dynamic</span> <span class="n">library</span> <span class="s1">&#39;libcuda.so.1&#39;</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcuda</span><span class="o">.</span><span class="n">so</span><span class="mf">.1</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">;</span> <span class="n">LD_LIBRARY_PATH</span><span class="p">:</span> <span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">runner</span><span class="o">/.</span><span class="n">idaes</span><span class="o">/</span><span class="nb">bin</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">07</span> <span class="mi">19</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">55.813279</span><span class="p">:</span> <span class="n">W</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">cuda_driver</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">263</span><span class="p">]</span> <span class="n">failed</span> <span class="n">call</span> <span class="n">to</span> <span class="n">cuInit</span><span class="p">:</span> <span class="n">UNKNOWN</span> <span class="n">ERROR</span> <span class="p">(</span><span class="mi">303</span><span class="p">)</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">07</span> <span class="mi">19</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">55.813310</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">cuda_diagnostics</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">156</span><span class="p">]</span> <span class="n">kernel</span> <span class="n">driver</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">appear</span> <span class="n">to</span> <span class="n">be</span> <span class="n">running</span> <span class="n">on</span> <span class="n">this</span> <span class="n">host</span> <span class="p">(</span><span class="mi">6</span><span class="n">fa2895353a7</span><span class="p">):</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">driver</span><span class="o">/</span><span class="n">nvidia</span><span class="o">/</span><span class="n">version</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">07</span> <span class="mi">19</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">55.813581</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">cpu_feature_guard</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">193</span><span class="p">]</span> <span class="n">This</span> <span class="n">TensorFlow</span> <span class="n">binary</span> <span class="ow">is</span> <span class="n">optimized</span> <span class="k">with</span> <span class="n">oneAPI</span> <span class="n">Deep</span> <span class="n">Neural</span> <span class="n">Network</span> <span class="n">Library</span> <span class="p">(</span><span class="n">oneDNN</span><span class="p">)</span> <span class="n">to</span> <span class="n">use</span> <span class="n">the</span> <span class="n">following</span> <span class="n">CPU</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">-</span><span class="n">critical</span> <span class="n">operations</span><span class="p">:</span>  <span class="n">AVX2</span> <span class="n">AVX512F</span> <span class="n">AVX512_VNNI</span> <span class="n">FMA</span>
<span class="n">To</span> <span class="n">enable</span> <span class="n">them</span> <span class="ow">in</span> <span class="n">other</span> <span class="n">operations</span><span class="p">,</span> <span class="n">rebuild</span> <span class="n">TensorFlow</span> <span class="k">with</span> <span class="n">the</span> <span class="n">appropriate</span> <span class="n">compiler</span> <span class="n">flags</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span><span class="n">tensorflow</span><span class="p">:</span><span class="n">Assets</span> <span class="n">written</span> <span class="n">to</span><span class="p">:</span> <span class="n">keras_surrogate</span><span class="o">/</span><span class="n">assets</span>
<span class="n">Epoch</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">75</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.3703</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.5194</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.3703</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.3230</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.4945</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.3230</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">17</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.3078</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.4684</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.3078</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.2686</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.4450</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.2686</span>
<span class="n">Epoch</span> <span class="mi">3</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">17</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.2556</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.4217</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.2556</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.2235</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.3991</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.2235</span>
<span class="n">Epoch</span> <span class="mi">4</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.2136</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.3798</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.2136</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.1862</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.3568</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.1862</span>
<span class="n">Epoch</span> <span class="mi">5</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.1792</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.3424</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.1792</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.1557</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.3193</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.1557</span>
<span class="n">Epoch</span> <span class="mi">6</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.1512</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.3100</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.1512</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.1303</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2857</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.1303</span>
<span class="n">Epoch</span> <span class="mi">7</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">15</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.1286</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2829</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.1286</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.1099</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2583</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.1099</span>
<span class="n">Epoch</span> <span class="mi">8</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.1108</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2615</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.1108</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0935</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2381</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0935</span>
<span class="n">Epoch</span> <span class="mi">9</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0969</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2445</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0969</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0810</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2227</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0810</span>
<span class="n">Epoch</span> <span class="mi">10</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0870</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2324</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0870</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0717</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2123</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0717</span>
<span class="n">Epoch</span> <span class="mi">11</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0795</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2228</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0795</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0650</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.2041</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0650</span>
<span class="n">Epoch</span> <span class="mi">12</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0745</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2165</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0745</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0599</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1972</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0599</span>
<span class="n">Epoch</span> <span class="mi">13</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0703</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2108</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0703</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0565</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1925</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0565</span>
<span class="n">Epoch</span> <span class="mi">14</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0670</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2056</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0670</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0534</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1879</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0534</span>
<span class="n">Epoch</span> <span class="mi">15</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">15</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0640</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.2005</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0640</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0506</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1828</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0506</span>
<span class="n">Epoch</span> <span class="mi">16</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0611</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1949</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0611</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0477</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1767</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0477</span>
<span class="n">Epoch</span> <span class="mi">17</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0582</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1889</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0582</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0454</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1711</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0454</span>
<span class="n">Epoch</span> <span class="mi">18</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0557</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1833</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0557</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0436</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1659</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0436</span>
<span class="n">Epoch</span> <span class="mi">19</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">17</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0533</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1778</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0533</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0418</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1601</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0418</span>
<span class="n">Epoch</span> <span class="mi">20</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0514</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1727</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0514</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0403</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1546</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0403</span>
<span class="n">Epoch</span> <span class="mi">21</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0496</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1681</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0496</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0385</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1487</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0385</span>
<span class="n">Epoch</span> <span class="mi">22</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0479</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1630</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0479</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0370</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1437</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0370</span>
<span class="n">Epoch</span> <span class="mi">23</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0464</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1589</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0464</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0359</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1404</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0359</span>
<span class="n">Epoch</span> <span class="mi">24</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0449</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1550</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0449</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0347</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1372</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0347</span>
<span class="n">Epoch</span> <span class="mi">25</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.0433</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.1511</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">0.0433</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">0.0335</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.1347</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">0.0335</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3688e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0084</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3688e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">9.2093e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0068</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">9.2093e-05</span>
<span class="n">Epoch</span> <span class="mi">977</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3427e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0085</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3427e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.4303e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0067</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.4303e-05</span>
<span class="n">Epoch</span> <span class="mi">978</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3646e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0087</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3646e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">9.1711e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0071</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">9.1711e-05</span>
<span class="n">Epoch</span> <span class="mi">979</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3732e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0087</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3732e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.2200e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0067</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.2200e-05</span>
<span class="n">Epoch</span> <span class="mi">980</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2526e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2526e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">1.0392e-04</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0074</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">1.0392e-04</span>
<span class="n">Epoch</span> <span class="mi">981</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3412e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3412e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.1916e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0065</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.1916e-05</span>
<span class="n">Epoch</span> <span class="mi">982</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.3123e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0085</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.3123e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.0986e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0067</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.0986e-05</span>
<span class="n">Epoch</span> <span class="mi">983</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">12</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2668e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0084</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2668e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.8134e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0069</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.8134e-05</span>
<span class="n">Epoch</span> <span class="mi">984</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2770e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2770e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.4017e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0066</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.4017e-05</span>
<span class="n">Epoch</span> <span class="mi">985</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2767e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0081</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2767e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.7591e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0064</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.7591e-05</span>
<span class="n">Epoch</span> <span class="mi">986</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2811e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0085</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2811e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.8276e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0066</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.8276e-05</span>
<span class="n">Epoch</span> <span class="mi">987</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2328e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2328e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">9.2079e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0071</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">9.2079e-05</span>
<span class="n">Epoch</span> <span class="mi">988</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2592e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0081</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2592e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.5439e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0064</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.5439e-05</span>
<span class="n">Epoch</span> <span class="mi">989</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2697e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0086</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2697e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.1590e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0068</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.1590e-05</span>
<span class="n">Epoch</span> <span class="mi">990</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2365e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2365e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.8449e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0067</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.8449e-05</span>
<span class="n">Epoch</span> <span class="mi">991</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2486e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0079</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2486e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.3745e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0065</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.3745e-05</span>
<span class="n">Epoch</span> <span class="mi">992</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2131e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2131e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.8311e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0066</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.8311e-05</span>
<span class="n">Epoch</span> <span class="mi">993</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.2277e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0083</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.2277e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.5934e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0064</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.5934e-05</span>
<span class="n">Epoch</span> <span class="mi">994</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1942e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0082</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1942e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.9994e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0067</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.9994e-05</span>
<span class="n">Epoch</span> <span class="mi">995</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1739e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0079</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1739e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.5978e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0066</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.5978e-05</span>
<span class="n">Epoch</span> <span class="mi">996</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1918e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0078</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1918e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.7404e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0062</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.7404e-05</span>
<span class="n">Epoch</span> <span class="mi">997</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1708e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0080</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1708e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.7886e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0064</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.7886e-05</span>
<span class="n">Epoch</span> <span class="mi">998</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1993e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0079</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1993e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.7599e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0065</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.7599e-05</span>
<span class="n">Epoch</span> <span class="mi">999</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">16</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1611e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0081</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1611e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">7.2370e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0064</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">7.2370e-05</span>
<span class="n">Epoch</span> <span class="mi">1000</span><span class="o">/</span><span class="mi">1000</span>
<span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">11</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span> <span class="o">-</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">1.1746e-04</span> <span class="o">-</span> <span class="n">mae</span><span class="p">:</span> <span class="mf">0.0083</span> <span class="o">-</span> <span class="n">mse</span><span class="p">:</span> <span class="mf">1.1746e-04</span> <span class="o">-</span> <span class="n">val_loss</span><span class="p">:</span> <span class="mf">8.1322e-05</span> <span class="o">-</span> <span class="n">val_mae</span><span class="p">:</span> <span class="mf">0.0068</span> <span class="o">-</span> <span class="n">val_mse</span><span class="p">:</span> <span class="mf">8.1322e-05</span>
</pre></div>
</div>
</section>
<section id="visualizing-surrogates">
<h2>3.3 Visualizing surrogates<a class="headerlink" href="#visualizing-surrogates" title="Permalink to this heading">¶</a></h2>
<p>Now that the surrogate models have been trained, the models can be
visualized through scatter, parity and residual plots to confirm their
validity in the chosen domain. The training data will be visualized
first to confirm the surrogates are fit the data, and then the
validation data will be visualized to confirm the surrogates accurately
predict new output values.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize with IDAES surrogate plotting tools</span>
<span class="n">surrogate_scatter2D</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_training</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_train_scatter2D.pdf&#39;</span><span class="p">)</span>
<span class="n">surrogate_parity</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_training</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_train_parity.pdf&#39;</span><span class="p">)</span>
<span class="n">surrogate_residual</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_training</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_train_residual.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">1</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_15_1.png" src="../../../_images/output_15_1.png" />
<img alt="../../../_images/output_15_2.png" src="../../../_images/output_15_2.png" />
<img alt="../../../_images/output_15_3.png" src="../../../_images/output_15_3.png" />
<img alt="../../../_images/output_15_4.png" src="../../../_images/output_15_4.png" />
<img alt="../../../_images/output_15_5.png" src="../../../_images/output_15_5.png" />
<img alt="../../../_images/output_15_6.png" src="../../../_images/output_15_6.png" />
<img alt="../../../_images/output_15_7.png" src="../../../_images/output_15_7.png" />
<img alt="../../../_images/output_15_8.png" src="../../../_images/output_15_8.png" />
<img alt="../../../_images/output_15_9.png" src="../../../_images/output_15_9.png" />
<img alt="../../../_images/output_15_10.png" src="../../../_images/output_15_10.png" />
<img alt="../../../_images/output_15_11.png" src="../../../_images/output_15_11.png" />
<img alt="../../../_images/output_15_12.png" src="../../../_images/output_15_12.png" />
<img alt="../../../_images/output_15_13.png" src="../../../_images/output_15_13.png" />
<img alt="../../../_images/output_15_14.png" src="../../../_images/output_15_14.png" />
<img alt="../../../_images/output_15_15.png" src="../../../_images/output_15_15.png" />
<img alt="../../../_images/output_15_16.png" src="../../../_images/output_15_16.png" />
<img alt="../../../_images/output_15_17.png" src="../../../_images/output_15_17.png" />
<img alt="../../../_images/output_15_18.png" src="../../../_images/output_15_18.png" />
<img alt="../../../_images/output_15_19.png" src="../../../_images/output_15_19.png" />
<img alt="../../../_images/output_15_20.png" src="../../../_images/output_15_20.png" />
<img alt="../../../_images/output_15_21.png" src="../../../_images/output_15_21.png" />
<img alt="../../../_images/output_15_22.png" src="../../../_images/output_15_22.png" />
<img alt="../../../_images/output_15_23.png" src="../../../_images/output_15_23.png" />
<img alt="../../../_images/output_15_24.png" src="../../../_images/output_15_24.png" />
<img alt="../../../_images/output_15_25.png" src="../../../_images/output_15_25.png" />
<img alt="../../../_images/output_15_26.png" src="../../../_images/output_15_26.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">1</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_15_28.png" src="../../../_images/output_15_28.png" />
<img alt="../../../_images/output_15_29.png" src="../../../_images/output_15_29.png" />
<img alt="../../../_images/output_15_30.png" src="../../../_images/output_15_30.png" />
<img alt="../../../_images/output_15_31.png" src="../../../_images/output_15_31.png" />
<img alt="../../../_images/output_15_32.png" src="../../../_images/output_15_32.png" />
<img alt="../../../_images/output_15_33.png" src="../../../_images/output_15_33.png" />
<img alt="../../../_images/output_15_34.png" src="../../../_images/output_15_34.png" />
<img alt="../../../_images/output_15_35.png" src="../../../_images/output_15_35.png" />
<img alt="../../../_images/output_15_36.png" src="../../../_images/output_15_36.png" />
<img alt="../../../_images/output_15_37.png" src="../../../_images/output_15_37.png" />
<img alt="../../../_images/output_15_38.png" src="../../../_images/output_15_38.png" />
<img alt="../../../_images/output_15_39.png" src="../../../_images/output_15_39.png" />
<img alt="../../../_images/output_15_40.png" src="../../../_images/output_15_40.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">1</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_15_42.png" src="../../../_images/output_15_42.png" />
<img alt="../../../_images/output_15_43.png" src="../../../_images/output_15_43.png" />
<img alt="../../../_images/output_15_44.png" src="../../../_images/output_15_44.png" />
<img alt="../../../_images/output_15_45.png" src="../../../_images/output_15_45.png" />
<img alt="../../../_images/output_15_46.png" src="../../../_images/output_15_46.png" />
<img alt="../../../_images/output_15_47.png" src="../../../_images/output_15_47.png" />
<img alt="../../../_images/output_15_48.png" src="../../../_images/output_15_48.png" />
<img alt="../../../_images/output_15_49.png" src="../../../_images/output_15_49.png" />
<img alt="../../../_images/output_15_50.png" src="../../../_images/output_15_50.png" />
<img alt="../../../_images/output_15_51.png" src="../../../_images/output_15_51.png" />
<img alt="../../../_images/output_15_52.png" src="../../../_images/output_15_52.png" />
<img alt="../../../_images/output_15_53.png" src="../../../_images/output_15_53.png" />
<img alt="../../../_images/output_15_54.png" src="../../../_images/output_15_54.png" />
<img alt="../../../_images/output_15_55.png" src="../../../_images/output_15_55.png" />
<img alt="../../../_images/output_15_56.png" src="../../../_images/output_15_56.png" />
<img alt="../../../_images/output_15_57.png" src="../../../_images/output_15_57.png" />
<img alt="../../../_images/output_15_58.png" src="../../../_images/output_15_58.png" />
<img alt="../../../_images/output_15_59.png" src="../../../_images/output_15_59.png" />
<img alt="../../../_images/output_15_60.png" src="../../../_images/output_15_60.png" />
<img alt="../../../_images/output_15_61.png" src="../../../_images/output_15_61.png" />
<img alt="../../../_images/output_15_62.png" src="../../../_images/output_15_62.png" />
<img alt="../../../_images/output_15_63.png" src="../../../_images/output_15_63.png" />
<img alt="../../../_images/output_15_64.png" src="../../../_images/output_15_64.png" />
<img alt="../../../_images/output_15_65.png" src="../../../_images/output_15_65.png" />
<img alt="../../../_images/output_15_66.png" src="../../../_images/output_15_66.png" />
<img alt="../../../_images/output_15_67.png" src="../../../_images/output_15_67.png" />
</section>
<section id="model-validation">
<h2>3.4 Model Validation<a class="headerlink" href="#model-validation" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize with IDAES surrogate plotting tools</span>
<span class="n">surrogate_scatter2D</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_validation</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_val_scatter2D.pdf&#39;</span><span class="p">)</span>
<span class="n">surrogate_parity</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_validation</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_val_parity.pdf&#39;</span><span class="p">)</span>
<span class="n">surrogate_residual</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span> <span class="n">data_validation</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;keras_val_residual.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">19</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_17_1.png" src="../../../_images/output_17_1.png" />
<img alt="../../../_images/output_17_2.png" src="../../../_images/output_17_2.png" />
<img alt="../../../_images/output_17_3.png" src="../../../_images/output_17_3.png" />
<img alt="../../../_images/output_17_4.png" src="../../../_images/output_17_4.png" />
<img alt="../../../_images/output_17_5.png" src="../../../_images/output_17_5.png" />
<img alt="../../../_images/output_17_6.png" src="../../../_images/output_17_6.png" />
<img alt="../../../_images/output_17_7.png" src="../../../_images/output_17_7.png" />
<img alt="../../../_images/output_17_8.png" src="../../../_images/output_17_8.png" />
<img alt="../../../_images/output_17_9.png" src="../../../_images/output_17_9.png" />
<img alt="../../../_images/output_17_10.png" src="../../../_images/output_17_10.png" />
<img alt="../../../_images/output_17_11.png" src="../../../_images/output_17_11.png" />
<img alt="../../../_images/output_17_12.png" src="../../../_images/output_17_12.png" />
<img alt="../../../_images/output_17_13.png" src="../../../_images/output_17_13.png" />
<img alt="../../../_images/output_17_14.png" src="../../../_images/output_17_14.png" />
<img alt="../../../_images/output_17_15.png" src="../../../_images/output_17_15.png" />
<img alt="../../../_images/output_17_16.png" src="../../../_images/output_17_16.png" />
<img alt="../../../_images/output_17_17.png" src="../../../_images/output_17_17.png" />
<img alt="../../../_images/output_17_18.png" src="../../../_images/output_17_18.png" />
<img alt="../../../_images/output_17_19.png" src="../../../_images/output_17_19.png" />
<img alt="../../../_images/output_17_20.png" src="../../../_images/output_17_20.png" />
<img alt="../../../_images/output_17_21.png" src="../../../_images/output_17_21.png" />
<img alt="../../../_images/output_17_22.png" src="../../../_images/output_17_22.png" />
<img alt="../../../_images/output_17_23.png" src="../../../_images/output_17_23.png" />
<img alt="../../../_images/output_17_24.png" src="../../../_images/output_17_24.png" />
<img alt="../../../_images/output_17_25.png" src="../../../_images/output_17_25.png" />
<img alt="../../../_images/output_17_26.png" src="../../../_images/output_17_26.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">19</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_17_28.png" src="../../../_images/output_17_28.png" />
<img alt="../../../_images/output_17_29.png" src="../../../_images/output_17_29.png" />
<img alt="../../../_images/output_17_30.png" src="../../../_images/output_17_30.png" />
<img alt="../../../_images/output_17_31.png" src="../../../_images/output_17_31.png" />
<img alt="../../../_images/output_17_32.png" src="../../../_images/output_17_32.png" />
<img alt="../../../_images/output_17_33.png" src="../../../_images/output_17_33.png" />
<img alt="../../../_images/output_17_34.png" src="../../../_images/output_17_34.png" />
<img alt="../../../_images/output_17_35.png" src="../../../_images/output_17_35.png" />
<img alt="../../../_images/output_17_36.png" src="../../../_images/output_17_36.png" />
<img alt="../../../_images/output_17_37.png" src="../../../_images/output_17_37.png" />
<img alt="../../../_images/output_17_38.png" src="../../../_images/output_17_38.png" />
<img alt="../../../_images/output_17_39.png" src="../../../_images/output_17_39.png" />
<img alt="../../../_images/output_17_40.png" src="../../../_images/output_17_40.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="o">==============================</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span><span class="n">s</span> <span class="mi">19</span><span class="n">ms</span><span class="o">/</span><span class="n">step</span>
</pre></div>
</div>
<img alt="../../../_images/output_17_42.png" src="../../../_images/output_17_42.png" />
<img alt="../../../_images/output_17_43.png" src="../../../_images/output_17_43.png" />
<img alt="../../../_images/output_17_44.png" src="../../../_images/output_17_44.png" />
<img alt="../../../_images/output_17_45.png" src="../../../_images/output_17_45.png" />
<img alt="../../../_images/output_17_46.png" src="../../../_images/output_17_46.png" />
<img alt="../../../_images/output_17_47.png" src="../../../_images/output_17_47.png" />
<img alt="../../../_images/output_17_48.png" src="../../../_images/output_17_48.png" />
<img alt="../../../_images/output_17_49.png" src="../../../_images/output_17_49.png" />
<img alt="../../../_images/output_17_50.png" src="../../../_images/output_17_50.png" />
<img alt="../../../_images/output_17_51.png" src="../../../_images/output_17_51.png" />
<img alt="../../../_images/output_17_52.png" src="../../../_images/output_17_52.png" />
<img alt="../../../_images/output_17_53.png" src="../../../_images/output_17_53.png" />
<img alt="../../../_images/output_17_54.png" src="../../../_images/output_17_54.png" />
<img alt="../../../_images/output_17_55.png" src="../../../_images/output_17_55.png" />
<img alt="../../../_images/output_17_56.png" src="../../../_images/output_17_56.png" />
<img alt="../../../_images/output_17_57.png" src="../../../_images/output_17_57.png" />
<img alt="../../../_images/output_17_58.png" src="../../../_images/output_17_58.png" />
<img alt="../../../_images/output_17_59.png" src="../../../_images/output_17_59.png" />
<img alt="../../../_images/output_17_60.png" src="../../../_images/output_17_60.png" />
<img alt="../../../_images/output_17_61.png" src="../../../_images/output_17_61.png" />
<img alt="../../../_images/output_17_62.png" src="../../../_images/output_17_62.png" />
<img alt="../../../_images/output_17_63.png" src="../../../_images/output_17_63.png" />
<img alt="../../../_images/output_17_64.png" src="../../../_images/output_17_64.png" />
<img alt="../../../_images/output_17_65.png" src="../../../_images/output_17_65.png" />
<img alt="../../../_images/output_17_66.png" src="../../../_images/output_17_66.png" />
<img alt="../../../_images/output_17_67.png" src="../../../_images/output_17_67.png" />
</section>
</section>
<section id="idaes-flowsheet-integration">
<h1>4. IDAES Flowsheet Integration<a class="headerlink" href="#idaes-flowsheet-integration" title="Permalink to this heading">¶</a></h1>
<section id="build-and-run-idaes-flowsheet">
<h2>4.1 Build and Run IDAES Flowsheet<a class="headerlink" href="#build-and-run-idaes-flowsheet" title="Permalink to this heading">¶</a></h2>
<p>Next, we will build an IDAES flowsheet and import the surrogate model
object. A single Keras neural network model accounts for all input and
output variables, and the JSON model serialized earlier may be imported
into a single SurrogateBlock() component.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the IDAES model and flowsheet</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">FlowsheetBlock</span><span class="p">(</span><span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># create flowsheet input variables</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">bypass_frac</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;natural gas bypass fraction&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ng_steam_ratio</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;natural gas to steam ratio&#39;</span><span class="p">)</span>

<span class="c1"># create flowsheet output variables</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">steam_flowrate</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;steam flowrate&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">reformer_duty</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;reformer heat duty&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">AR</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;AR fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C2H6</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;C2H6 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C3H8</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;C3H8 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C4H10</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;C4H10 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CH4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;CH4 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;CO fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;CO2 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;H2 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2O</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;H2O fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;N2 fraction&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">O2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;O2 fraction&quot;</span><span class="p">)</span>

<span class="c1"># create input and output variable object lists for flowsheet</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">bypass_frac</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ng_steam_ratio</span><span class="p">]</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">steam_flowrate</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">reformer_duty</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">AR</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C2H6</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C4H10</span><span class="p">,</span>
           <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C3H8</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CH4</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2O</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">N2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">O2</span><span class="p">]</span>

<span class="c1"># create the Pyomo/IDAES block that corresponds to the surrogate</span>
<span class="c1"># Keras</span>
<span class="n">keras_surrogate</span> <span class="o">=</span> <span class="n">KerasSurrogate</span><span class="o">.</span><span class="n">load_from_folder</span><span class="p">(</span><span class="s1">&#39;keras_surrogate&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">surrogate</span> <span class="o">=</span> <span class="n">SurrogateBlock</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">surrogate</span><span class="o">.</span><span class="n">build_model</span><span class="p">(</span><span class="n">keras_surrogate</span><span class="p">,</span>
                           <span class="n">formulation</span><span class="o">=</span><span class="n">KerasSurrogate</span><span class="o">.</span><span class="n">Formulation</span><span class="o">.</span><span class="n">FULL_SPACE</span><span class="p">,</span>
                           <span class="n">input_vars</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output_vars</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>

<span class="c1"># fix input values and solve flowsheet</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">bypass_frac</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ng_steam_ratio</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">status_obj</span><span class="p">,</span> <span class="n">solved</span><span class="p">,</span> <span class="n">iters</span><span class="p">,</span> <span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">_run_ipopt_with_stats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Setting bound of fs.bypass_frac to (0.1, 0.8).
Setting bound of fs.ng_steam_ratio to (0.8, 1.2).
Ipopt 3.13.2: output_file=/tmp/tmpnw1sy89iipopt_out
max_iter=500
max_cpu_time=120


<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     2537
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:       80

Total number of variables............................:      216
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        4
                     variables with only upper bounds:        0
Total number of equality constraints.................:      216
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 1.91e+02 0.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 4.89e-01 4.65e+01  -1.7 1.12e+04    -  2.06e-02 1.00e+00f  1
   2  0.0000000e+00 1.07e-03 7.04e-15  -1.7 3.35e+02    -  1.00e+00 1.00e+00h  1
   3  0.0000000e+00 2.78e-16 3.08e-33  -3.8 1.36e+01    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 3

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   2.7755575615628914e-16    2.7755575615628914e-16
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   2.7755575615628914e-16    2.7755575615628914e-16


Number of objective function evaluations             = 4
Number of objective gradient evaluations             = 4
Number of equality constraint evaluations            = 4
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 4
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 3
Total CPU secs in IPOPT (w/o function evaluations)   =      0.009
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.</pre>
<p>Let’s print some model results:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model status: &quot;</span><span class="p">,</span> <span class="n">status_obj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solution optimal: &quot;</span><span class="p">,</span> <span class="n">solved</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IPOPT iterations: &quot;</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IPOPT runtime: &quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Steam flowrate = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">steam_flowrate</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reformer duty = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">reformer_duty</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction Ar = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">AR</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction C2H6 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C2H6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction C3H8 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C3H8</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction C4H10 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">C4H10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction CH4 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CH4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction CO = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction CO2 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">CO2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction H2 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction H2O = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2O</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction N2 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">N2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mole Fraction O2 = &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">O2</span><span class="p">))</span>
</pre></div>
</div>
<pre class="literal-block">Model status:
Problem:
- Lower bound: -inf
  Upper bound: inf
  Number of objectives: 1
  Number of constraints: 216
  Number of variables: 216
  Sense: unknown
Solver:
- Status: ok
  Message: Ipopt 3.13.2x3a Optimal Solution Found
  Termination condition: optimal
  Id: 0
  Error rc: 0
  Time: 0.0504918098449707
Solution:
- number of solutions: 0
  number of solutions displayed: 0

Solution optimal:  True
IPOPT iterations:  3
IPOPT runtime:  0.009

Steam flowrate =  0.6077816215658618
Reformer duty =  20895.00080765254
Mole Fraction Ar =  0.0036859286868388247
Mole Fraction C2H6 =  0.004174498310450582
Mole Fraction C3H8 =  0.000530460341814808
Mole Fraction C4H10 =  0.0009065644973371987
Mole Fraction CH4 =  0.12893526933666333
Mole Fraction CO =  0.09737578026912592
Mole Fraction CO2 =  0.04594305518105226
Mole Fraction H2 =  0.29471173957200514
Mole Fraction H2O =  0.12005265545024728
Mole Fraction N2 =  0.3067577119164617
Mole Fraction O2 =  2.47756192624712e-20</pre>
</section>
<section id="optimizing-the-autothermal-reformer">
<h2>4.2 Optimizing the Autothermal Reformer<a class="headerlink" href="#optimizing-the-autothermal-reformer" title="Permalink to this heading">¶</a></h2>
<p>Extending this example, we will unfix the input variables and optimize
hydrogen production. We will restrict nitrogen below 34 mol% of the
product stream and leave all other variables unfixed.</p>
<p>Above, variable values are called in reference to actual objects names;
however, as shown below this may be done much more compactly by calling
the list objects we created earlier.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># unfix input values and add the objective/constraint to the model</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">bypass_frac</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">ng_steam_ratio</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">maximize</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">N2</span> <span class="o">&lt;=</span> <span class="mf">0.34</span><span class="p">)</span>

<span class="c1"># solve the model</span>
<span class="n">tmr</span> <span class="o">=</span> <span class="n">TicTocTimer</span><span class="p">()</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">solve_time</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">toc</span><span class="p">(</span><span class="s1">&#39;solve&#39;</span><span class="p">)</span>

<span class="c1"># print and check results</span>
<span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">H2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.33</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span>
<span class="k">assert</span> <span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">N2</span> <span class="o">&lt;=</span> <span class="mf">0.4</span><span class="o">+</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model status: &#39;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solve time: &#39;</span><span class="p">,</span> <span class="n">solve_time</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</pre></div>
</div>
<pre class="literal-block">Ipopt 3.13.2:

<strong>**************************************************************************</strong>
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit <a class="reference external" href="http://projects.coin-or.org/Ipopt">http://projects.coin-or.org/Ipopt</a>

This version of Ipopt was compiled from source code available at
    <a class="reference external" href="https://github.com/IDAES/Ipopt">https://github.com/IDAES/Ipopt</a> as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See <a class="reference external" href="https://github.com/IDAES/idaes-pse">https://github.com/IDAES/idaes-pse</a>.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See <a class="reference external" href="http://www.hsl.rl.ac.uk">http://www.hsl.rl.ac.uk</a>.
<strong>**************************************************************************</strong>

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     2539
Number of nonzeros in inequality constraint Jacobian.:        1
Number of nonzeros in Lagrangian Hessian.............:       80

Total number of variables............................:      218
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        6
                     variables with only upper bounds:        0
Total number of equality constraints.................:      216
Total number of inequality constraints...............:        1
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        1

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0 -2.9471174e-01 2.78e-16 7.81e-04  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1 -2.9548899e-01 9.11e-05 1.18e-04  -1.7 1.96e+02    -  1.00e+00 1.00e+00f  1
   2 -3.1099179e-01 2.94e-02 7.27e-02  -3.8 3.92e+03    -  7.67e-01 1.00e+00h  1
   3 -3.2639604e-01 3.00e-02 2.37e-03  -3.8 6.08e+03    -  1.00e+00 1.00e+00h  1
   4 -3.3268248e-01 4.03e-02 1.89e-03  -3.8 7.05e+03    -  1.00e+00 1.00e+00h  1
   5 -3.3200211e-01 1.07e-03 2.56e-05  -3.8 5.20e+02    -  1.00e+00 1.00e+00h  1
   6 -3.3254615e-01 9.74e-05 8.56e-04  -5.7 4.43e+02    -  9.95e-01 9.80e-01h  1
   7 -3.3255540e-01 2.26e-06 1.27e+00  -5.7 3.33e+01    -  2.27e-02 1.00e+00h  1
   8 -3.3255584e-01 6.84e-10 9.64e-11  -5.7 4.79e-01    -  1.00e+00 1.00e+00h  1
   9 -3.3256321e-01 1.02e-08 4.89e-09  -8.6 4.22e+00    -  1.00e+00 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10 -3.3256322e-01 1.48e-13 2.48e-14  -9.0 6.68e-03    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 10

                                   (scaled)                 (unscaled)
Objective...............:  -3.3256322250908554e-01   -3.3256322250908554e-01
Dual infeasibility......:   2.4795920525177984e-14    2.4795920525177984e-14
Constraint violation....:   1.4832579608992091e-13    1.4832579608992091e-13
Complementarity.........:   9.2512506851345402e-10    9.2512506851345402e-10
Overall NLP error.......:   9.2512506851345402e-10    9.2512506851345402e-10


Number of objective function evaluations             = 11
Number of objective gradient evaluations             = 11
Number of equality constraint evaluations            = 11
Number of inequality constraint evaluations          = 11
Number of equality constraint Jacobian evaluations   = 11
Number of inequality constraint Jacobian evaluations = 11
Number of Lagrangian Hessian evaluations             = 10
Total CPU secs in IPOPT (w/o function evaluations)   =      0.021
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
[+   0.06] solve
Model status:
Problem:
- Lower bound: -inf
  Upper bound: inf
  Number of objectives: 1
  Number of constraints: 217
  Number of variables: 218
  Sense: unknown
Solver:
- Status: ok
  Message: Ipopt 3.13.2x3a Optimal Solution Found
  Termination condition: optimal
  Id: 0
  Error rc: 0
  Time: 0.04402804374694824
Solution:
- number of solutions: 0
  number of solutions displayed: 0

Solve time:  0.05912201851606369
fs.bypass_frac :  0.10000005409405593
fs.ng_steam_ratio :  1.104679413345877
fs.steam_flowrate :  1.1959738816361425
fs.reformer_duty :  38028.687012735056
fs.AR :  0.004110458324727334
fs.C2H6 :  0.0004476168291196369
fs.C4H10 :  0.00011014424304823685
fs.C3H8 :  7.244916119029471e-05
fs.CH4 :  0.017681627184011475
fs.CO :  0.10597964460231139
fs.CO2 :  0.05316701760275122
fs.H2 :  0.33256322250908554
fs.H2O :  0.1471026528365523
fs.N2 :  0.3400000072616813
fs.O2 :  3.3213204546208743e-20</pre>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright DOE Institute for the Design of Advanced Energy Systems (IDAES), 2018-2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div id="bottombanner">
    The IDAES team:
    <ul>
        <li>National Energy Technology Laboratory (Lead)</li>
        <li>Sandia National Laboratory</li>
        <li>Lawrence Berkeley National Laboratory</li>
        <li>Carnegie-Mellon University (subcontract to LBNL)</li>
        <li>West Virginia University (subcontract to LBNL)</li>
    </ul>
    <div id="contactinfo">
        General, background and overview information<br/> is available at the
        <a href="https://www.idaes.org>">IDAES main website</a>
    </div>
</div>


</body>
</html>